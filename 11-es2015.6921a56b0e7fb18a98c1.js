(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{"4k3B":function(e,t,c){"use strict";c.d(t,"a",(function(){return n})),c.d(t,"b",(function(){return i}));var n=function(e){return e.string="esriFieldTypeString",e.smallInteger="esriFieldTypeSmallInteger",e.integer="esriFieldTypeInteger",e.double="esriFieldTypeDouble",e.long="esriFieldTypeLong",e.date="esriFieldTypeDate",e.oid="esriFieldTypeOID",e.geometry="esriFieldTypeGeometry",e}({}),i=function(e){return e.Point="GeometryPoint",e.MultiPoint="GeometryMultipoint",e.Polyline="GeometryPolyline",e.Polygon="GeometryPolygon",e}({})},CjdU:function(e,t,c){"use strict";c.d(t,"a",(function(){return o}));var n=c("AytR"),i=c("i/XZ"),l=c("Zt20"),a=c("fXoL"),s=c("tk/3");let o=(()=>{class e extends i.a{constructor(e){super({apiUrl:n.a.apiUrl,entity:"sys/dataset"},e)}getGDBNotExists(){const e=l.a.create({filter:[{field:"notExist",operator:"$eq",value:!0}]});return this.http.get(this.getBaseUrl()+"/gdb",{params:this.getParamsFromQuery(e)})}getManyGDB(){return this.http.get(this.getBaseUrl()+"/gdb")}updateDatasetName(e,t){return this.http.post(this.getBaseUrl()+"/gdb/alias/"+e,{datasetName:t})}updateAliasNameFromGDB(e){return this.http.patch(this.getBaseUrl()+"/aliasfromgdb",{lstDatasetId:e},{headers:{"Content-Type":"application/json"}})}}return e.\u0275fac=function(t){return new(t||e)(a.hc(s.b))},e.\u0275prov=a.Tb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()},XdKL:function(e,t,c){"use strict";c.r(t),c.d(t,"LayerModule",(function(){return ge}));var n=c("ofXK"),i=c("bANk"),l=c("ExIg"),a=c("advQ"),s=c("CjdU"),o=c("fXoL"),r=c("aceb"),d=c("tyNb"),u=c("wnGv"),h=c("3Pt+"),b=c("mrSG"),g=c("VmTv");let p=(()=>{class e{constructor(e,t,c){this.toast=e,this.layerService=t,this.datasetService=c,this.close=new o.r,this.form=new h.e({datasetId:new h.c("",[h.s.required]),layerId:new h.c("",[h.s.required,h.s.minLength(5)]),layerName:new h.c("",[h.s.required,h.s.minLength(5)]),url:new h.c("",[h.s.required,h.s.minLength(5)]),isApi:new h.c(!1)}),this.status={saving:!1}}ngOnInit(){}submit(){return Object(b.a)(this,void 0,void 0,(function*(){if(this.form.valid)try{this.status.saving=!0,yield this.layerService.create(this.form.value).toPromise(),this.toast.success("Th\xeam th\xe0nh c\xf4ng"),this.form.reset({datasetId:this.form.get("datasetId").value})}catch(e){this.toast.danger(e.message,"L\u1ed7i")}finally{this.status.saving=!1}}))}}return e.\u0275fac=function(t){return new(t||e)(o.Xb(r.qb),o.Xb(i.a),o.Xb(s.a))},e.\u0275cmp=o.Rb({type:e,selectors:[["app-them-moi-layer"]],outputs:{close:"close"},decls:22,vars:14,consts:[[3,"open"],[3,"formGroup","ngSubmit"],[1,"row"],[1,"col-md-12"],["fieldSize","small","fieldName","datasetName","fieldValue","datasetId",3,"service","fullWidth","valueChange"],[1,"col-md-6","col-xs-12","mb-1","mt-1"],["nbInput","","fieldSize","small","placeholder","M\xe3","formControlName","layerId",3,"tabIndex","fullWidth","status"],["nbInput","","fieldSize","small","placeholder","T\xean","formControlName","layerName",3,"fullWidth","status"],[1,"col-md-12","mb-1","mt-1"],[1,"d-flex"],["nbInput","","fieldSize","small","placeholder","\u0110\u01b0\u1eddng d\u1eabn","formControlName","url",1,"flex-1","pr-1",3,"fullWidth","status"],["formControlName","isApi",1,"pl-1",3,"status"],[1,"d-flex","justify-content-end"],["nbButton","","size","small","ghost","",3,"click"],["nbButton","","size","small","type","submit",3,"disabled","nbSpinner"]],template:function(e,t){1&e&&(o.dc(0,"dn-dialog",0),o.dc(1,"dn-dialog-header"),o.Oc(2,"Th\xeam m\u1edbi l\u1edbp d\u1eef li\u1ec7u"),o.cc(),o.dc(3,"dn-dialog-body"),o.dc(4,"form",1),o.kc("ngSubmit",(function(){return t.submit()})),o.dc(5,"div",2),o.dc(6,"div",3),o.dc(7,"dn-auto-complete",4),o.kc("valueChange",(function(e){return t.form.get("datasetId").setValue(e)})),o.cc(),o.cc(),o.dc(8,"div",5),o.Yb(9,"input",6),o.cc(),o.dc(10,"div",5),o.Yb(11,"input",7),o.cc(),o.dc(12,"div",8),o.dc(13,"div",9),o.Yb(14,"input",10),o.dc(15,"nb-checkbox",11),o.Oc(16,"API"),o.cc(),o.cc(),o.cc(),o.cc(),o.dc(17,"dn-dialog-footer",12),o.dc(18,"button",13),o.kc("click",(function(){return t.close.emit()})),o.Oc(19,"\u0110\xf3ng"),o.cc(),o.dc(20,"button",14),o.Oc(21," Th\xeam m\u1edbi "),o.cc(),o.cc(),o.cc(),o.cc(),o.cc()),2&e&&(o.sc("open",!0),o.Lb(4),o.sc("formGroup",t.form),o.Lb(3),o.sc("service",t.datasetService)("fullWidth",!0),o.Lb(2),o.sc("tabIndex",1)("fullWidth",!0)("status",t.form.get("layerId").touched&&t.form.get("layerId").invalid?"danger":"basic"),o.Lb(2),o.sc("fullWidth",!0)("status",t.form.get("layerName").touched&&t.form.get("layerName").invalid?"danger":"basic"),o.Lb(3),o.sc("fullWidth",!0)("status",t.form.get("url").touched&&t.form.get("url").invalid?"danger":"basic"),o.Lb(1),o.sc("status",t.form.get("isApi").touched&&t.form.get("isApi").invalid?"danger":"basic"),o.Lb(5),o.sc("disabled",!t.form.valid)("nbSpinner",t.status.saving))},directives:[g.d,g.f,g.c,h.u,h.k,h.f,g.a,r.G,h.b,h.j,h.d,r.v,g.e,r.o,r.kb],styles:[""]}),e})();var m=c("nYR2");function y(e,t){if(1&e&&(o.dc(0,"p",14),o.Oc(1),o.cc()),2&e){const e=t.value;o.sc("nbTooltip",e),o.Lb(1),o.Pc(e)}}function f(e,t){if(1&e&&(o.dc(0,"p",14),o.Oc(1),o.cc()),2&e){const e=t.value;o.sc("nbTooltip",e),o.Lb(1),o.Pc(e)}}const v=function(){return{fieldValue:"datasetId",fieldName:"datasetName"}};let w=(()=>{class e{constructor(e,t,c){this.layerService=e,this.datasetService=t,this.toast=c,this.close=new o.r,this.lstGDBRow=[],this.lstTmpGDBRow=[],this.lstDatasetGDB=[],this.lstDatasetIdGDBSelected=[],this.lstLayerSelected=[],this.isSync=!1}ngOnInit(){this.loadLayerGDB(),this.datasetService.getManyGDB().subscribe(e=>this.lstDatasetGDB=e)}loadLayerGDB(){this.layerService.getManyGDB({filter:[{field:"notExist",value:!0,operator:"$eq"}]}).subscribe(e=>{this.lstGDBRow=e,this.lstTmpGDBRow=[...e],this.filterGDB()})}filterGDB(){if(this.lstDatasetIdGDBSelected.length){const e=this.lstTmpGDBRow.filter(e=>this.lstDatasetIdGDBSelected.indexOf(e.datasetId)>-1);this.lstGDBRow=e}}syncFromGDB(e){this.isSync=!0,this.layerService.createMany(e).pipe(Object(m.a)(()=>this.isSync=!1)).subscribe(()=>{this.toast.success("\u0110\xe3 chuy\u1ec3n d\u1eef li\u1ec7u sang danh s\xe1ch qu\u1ea3n l\xfd","Th\xe0nh c\xf4ng"),this.loadLayerGDB(),this.lstLayerSelected=[]},e=>this.toast.danger(e||"C\xf3 l\u1ed7i x\u1ea3y ra","L\u1ed7i"))}bulkClick(e){"update"===e.action.name&&this.lstLayerSelected.length&&this.layerService.updateAliasNameFromGDB(this.lstLayerSelected.map(e=>e.layerId)).subscribe(e=>{this.toast.success("C\u1eadp nh\u1eadt th\xe0nh c\xf4ng","Th\xe0nh c\xf4ng")},e=>this.toast.danger(e))}}return e.\u0275fac=function(t){return new(t||e)(o.Xb(i.a),o.Xb(s.a),o.Xb(r.qb))},e.\u0275cmp=o.Rb({type:e,selectors:[["app-from-gdb"]],outputs:{close:"close"},decls:21,vars:10,consts:[["width","100vw","maxWidth","100vw",3,"open"],[1,"d-flex","justify-content-between"],["nbButton","","size","small","ghost","","nbTooltip","T\u1ea3i l\u1ea1i",3,"click"],["icon","refresh"],["nbButton","","size","small","ghost","","nbTooltip","\u0110\xf3ng","status","danger",3,"click"],["icon","close"],["fullWidth","","multiple","","placeholder","Ch\u1ecdn dataset",3,"lstValue","config","value","valueChange"],["selectionType","checkbox",1,"material","mt-2",3,"rows","limit","selected","footerHeight","bulkClick","select"],["tableGDB",""],["minWidth","100","name","M\xe3","prop","layerId"],["ngn-datatable-cell-template",""],["minWidth","400","name","T\xean","prop","layerName"],[1,"d-flex","justify-content-end"],["nbButton","","outline","","size","small","status","primary","tabindex","0","nbTooltip","Chuy\u1ec3n d\u1eef li\u1ec7u \u0111\u1ec3 cung c\u1ea5p cho c\xe1c \u1ee9ng d\u1ee5ng",3,"disabled","click"],[3,"nbTooltip"]],template:function(e,t){if(1&e){const e=o.ec();o.dc(0,"dn-dialog",0),o.dc(1,"dn-dialog-header",1),o.dc(2,"span"),o.Oc(3,"L\u1edbp d\u1eef li\u1ec7u t\u1eeb GDB"),o.cc(),o.dc(4,"div"),o.dc(5,"button",2),o.kc("click",(function(){return t.loadLayerGDB()})),o.Yb(6,"nb-icon",3),o.cc(),o.dc(7,"button",4),o.kc("click",(function(){return t.close.emit()})),o.Yb(8,"nb-icon",5),o.cc(),o.cc(),o.cc(),o.dc(9,"dn-dialog-body"),o.dc(10,"ga-select",6),o.kc("valueChange",(function(e){return t.lstDatasetIdGDBSelected=e}))("valueChange",(function(){return t.filterGDB()})),o.cc(),o.dc(11,"ngn-datatable",7,8),o.kc("bulkClick",(function(e){return t.bulkClick(e)}))("select",(function(e){return t.lstLayerSelected=e.selected})),o.dc(13,"ngn-datatable-column",9),o.Mc(14,y,2,2,"ng-template",10),o.cc(),o.dc(15,"ngn-datatable-column",11),o.Mc(16,f,2,2,"ng-template",10),o.cc(),o.cc(),o.cc(),o.dc(17,"dn-dialog-footer",12),o.dc(18,"button",13),o.kc("click",(function(){o.Dc(e);const c=o.Ac(12);return t.syncFromGDB(c.selected)})),o.Oc(19," Chuy\u1ec3n d\u1eef li\u1ec7u "),o.cc(),o.Oc(20,"` "),o.cc(),o.cc()}if(2&e){const e=o.Ac(12);o.sc("open",!0),o.Lb(10),o.sc("lstValue",t.lstDatasetGDB)("config",o.uc(9,v))("value",t.lstDatasetIdGDBSelected),o.Lb(1),o.sc("rows",t.lstGDBRow)("limit",10)("selected",t.lstLayerSelected)("footerHeight",50),o.Lb(7),o.sc("disabled",!e.selected.length||t.isSync)}},directives:[g.d,g.f,r.o,r.rb,r.D,g.c,u.a,l.d,l.c,l.b,g.e],styles:[""]}),e})();const k=["table"],C=["cellTplLayerName"],T=["celxTplLayerName"];function D(e,t){if(1&e){const e=o.ec();o.dc(0,"input",16),o.kc("ngModelChange",(function(c){return o.Dc(e),t.row.layerName=c}))("change",(function(){o.Dc(e);const c=t.row;return o.mc().update(c)})),o.cc()}2&e&&o.sc("ngModel",t.row.layerName)}function I(e,t){if(1&e){const e=o.ec();o.dc(0,"input",16),o.kc("ngModelChange",(function(c){return o.Dc(e),t.row.stt=c}))("change",(function(){o.Dc(e);const c=t.row;return o.mc().update(c)})),o.cc()}2&e&&o.sc("ngModel",t.row.stt)}function L(e,t){if(1&e){const e=o.ec();o.dc(0,"input",16),o.kc("ngModelChange",(function(c){return o.Dc(e),t.row.url=c}))("change",(function(){o.Dc(e);const c=t.row;return o.mc().update(c)})),o.cc()}2&e&&o.sc("ngModel",t.row.url)}function S(e,t){if(1&e){const e=o.ec();o.dc(0,"app-them-moi-layer",17),o.kc("close",(function(){return o.Dc(e),o.mc().dlgThemMoiLayer=!1})),o.cc()}}function M(e,t){if(1&e){const e=o.ec();o.dc(0,"app-from-gdb",17),o.kc("close",(function(){return o.Dc(e),o.mc().isDlgFromGDB=!1})),o.cc()}}const O=function(){return{fieldValue:"datasetId",fieldName:"datasetName"}};let B=(()=>{class e{constructor(e,t,c,n,i){this.layerService=e,this.datasetService=t,this.toast=c,this.router=n,this.route=i,this.UserStatusEnum=a.b,this.ColumnMode=l.a,this.lstBulk=[{name:"delete",title:"X\xf3a"}],this.actions=[{name:"view",tooltip:"Xem l\u1edbp GDB",click:e=>{this.router.navigate(["detail",e.layerId],{relativeTo:this.route})}},{name:"delete"}],this.datatableService={service:this.layerService,primaryField:"layerId",builder:this.getBuilder.bind(this)},this.lstDataset=[],this.lstDatasetIdSelected=[],this.isDlgFromGDB=!1,this.dlgThemMoiLayer=!1}ngOnInit(){this.datasetService.getMany().subscribe(e=>this.lstDataset=e)}viewFieldRequest(e){}getBuilder(e){e.select(["layerName","url","stt"]),e.setFilter({field:"datasetId",operator:"$in",value:this.lstDatasetIdSelected})}update(e){this.layerService.patch(e.layerId,{layerName:e.layerName,url:e.url,isApi:e.isApi,stt:e.stt}).subscribe(()=>{this.toast.success("C\u1eadp nh\u1eadt th\xe0nh c\xf4ng","Th\xe0nh c\xf4ng")},e=>this.toast.success(e,"L\u1ed7i"))}}return e.\u0275fac=function(t){return new(t||e)(o.Xb(i.a),o.Xb(s.a),o.Xb(r.qb),o.Xb(d.c),o.Xb(d.a))},e.\u0275cmp=o.Rb({type:e,selectors:[["ga-layer"]],viewQuery:function(e,t){var c;1&e&&(o.Sc(k,!0),o.Jc(C,!0),o.Jc(T,!0)),2&e&&(o.zc(c=o.lc())&&(t.table=c.first),o.zc(c=o.lc())&&(t.cellTplLayerName=c.first),o.zc(c=o.lc())&&(t.celxTplLayerName=c.first))},decls:26,vars:17,consts:[[1,"d-flex","justify-content-between"],["size","small","nbButton","","ghost","","nbTooltip","T\u1ea3i l\u1ea1i",3,"click"],["icon","refresh"],["nbButton","","size","small","status","primary","ghost","","nbTooltip","N\u1ea1p d\u1eef li\u1ec7u t\u1eeb GDB",3,"click"],["icon","arrow-circle-down"],["size","small","nbButton","","outline","","nbTooltip","Th\xeam m\u1edbi","status","primary",3,"click"],["icon","plus"],["fullWidth","","placeholder","Ch\u1ecdn dataset",3,"lstValue","multiple","value","config","valueChange"],["selectionType","checkbox",1,"material","striped","mt-2",3,"externalPaging","limit","datatableService","actions","bulkActions","scrollbarH"],["table",""],["name","M\xe3","prop","layerId",3,"width"],["name","T\xean","prop","layerName",3,"width"],["ngn-datatable-cell-template",""],["name","STT","prop","stt",3,"width"],["name","\u0110\u01b0\u1eddng d\u1eabn","prop","url",3,"width"],[3,"close",4,"ngIf"],["nbInput","","fieldSize","small","fullWidth","",3,"ngModel","ngModelChange","change"],[3,"close"]],template:function(e,t){if(1&e){const e=o.ec();o.dc(0,"nb-card"),o.dc(1,"nb-card-header",0),o.dc(2,"span"),o.Oc(3,"L\u1edbp d\u1eef li\u1ec7u"),o.cc(),o.dc(4,"div"),o.dc(5,"button",1),o.kc("click",(function(){return o.Dc(e),o.Ac(15).loadData()})),o.Yb(6,"nb-icon",2),o.cc(),o.dc(7,"button",3),o.kc("click",(function(){return t.isDlgFromGDB=!0})),o.Yb(8,"nb-icon",4),o.cc(),o.dc(9,"button",5),o.kc("click",(function(){return t.dlgThemMoiLayer=!0})),o.Yb(10,"nb-icon",6),o.Oc(11," Th\xeam m\u1edbi "),o.cc(),o.cc(),o.cc(),o.dc(12,"nb-card-body"),o.dc(13,"ga-select",7),o.kc("valueChange",(function(e){return t.lstDatasetIdSelected=e}))("valueChange",(function(){return o.Dc(e),o.Ac(15).loadData()})),o.cc(),o.dc(14,"ngn-datatable",8,9),o.Yb(16,"ngn-datatable-column",10),o.dc(17,"ngn-datatable-column",11),o.Mc(18,D,1,1,"ng-template",12),o.cc(),o.dc(19,"ngn-datatable-column",13),o.Mc(20,I,1,1,"ng-template",12),o.cc(),o.dc(21,"ngn-datatable-column",14),o.Mc(22,L,1,1,"ng-template",12),o.cc(),o.cc(),o.cc(),o.cc(),o.Mc(23,S,1,0,"app-them-moi-layer",15),o.Mc(24,M,1,0,"app-from-gdb",15),o.Yb(25,"router-outlet")}2&e&&(o.Lb(13),o.sc("lstValue",t.lstDataset)("multiple",!0)("value",t.lstDatasetIdSelected)("config",o.uc(16,O)),o.Lb(1),o.sc("externalPaging",!0)("limit",10)("datatableService",t.datatableService)("actions",t.actions)("bulkActions",t.lstBulk)("scrollbarH",!0),o.Lb(2),o.sc("width",150),o.Lb(1),o.sc("width",250),o.Lb(2),o.sc("width",100),o.Lb(2),o.sc("width",600),o.Lb(2),o.sc("ngIf",t.dlgThemMoiLayer),o.Lb(1),o.sc("ngIf",t.isDlgFromGDB))},directives:[r.r,r.t,r.o,r.rb,r.D,r.q,u.a,l.d,l.c,l.b,n.u,d.h,r.G,h.b,h.j,h.m,p,w],styles:[""]}),e})();var x=c("BDdu"),N=c("1ua0");let G=(()=>{class e{}return e.\u0275mod=o.Vb({type:e}),e.\u0275inj=o.Ub({factory:function(t){return new(t||e)},imports:[[n.c,N.a,r.p,l.e]]}),e})();var F=c("jF+W");const j=["dlgViewField"];let P=(()=>{class e{constructor(e,t,c){this.router=e,this.activatedRoute=t,this.layerService=c,this.userConfig={closeOnBackdropClick:!1},this.columnsViewField=[]}ngOnInit(){this.columnsViewField=[{name:"M\xe3 c\u1ed9t",prop:"name"},{name:"T\xean c\u1ed9t",prop:"alias"},{name:"Ki\u1ec3u d\u1eef li\u1ec7u",prop:"type"},{name:"R\u1ed7ng",prop:"isNullable"},{name:"Domain",prop:"domainId"}],this.activatedRoute.paramMap.subscribe(e=>{const t=e.get("layerId");this.layerService.getOne(t,{fields:["layerId","layerName"],join:{field:"fields"}}).subscribe(e=>{this.viewField=e})})}closeViewField(){this.router.navigate(["../.."],{relativeTo:this.activatedRoute})}ngOnDestroy(){this.dlgViewField.close()}}return e.\u0275fac=function(t){return new(t||e)(o.Xb(d.c),o.Xb(d.a),o.Xb(i.a))},e.\u0275cmp=o.Rb({type:e,selectors:[["ga-field"]],viewQuery:function(e,t){var c;1&e&&o.Jc(j,!0),2&e&&o.zc(c=o.lc())&&(t.dlgViewField=c.first)},decls:9,vars:9,consts:[[3,"open","userConfig"],["dlgViewField",""],[1,"body"],[1,"material","striped","mt-2",3,"externalPaging","columns","rows","scrollbarH"],["nbButton","","size","small","ghost","",3,"click"]],template:function(e,t){1&e&&(o.dc(0,"core-dialog",0,1),o.dc(2,"core-dialog-header"),o.Oc(3),o.cc(),o.dc(4,"core-dialog-body",2),o.Yb(5,"ngn-datatable",3),o.cc(),o.dc(6,"core-dialog-footer"),o.dc(7,"button",4),o.kc("click",(function(){return t.closeViewField()})),o.Oc(8,"\u0110\xf3ng"),o.cc(),o.cc(),o.cc()),2&e&&(o.sc("open",!0)("userConfig",t.userConfig),o.Lb(3),o.Qc("Thu\u1ed9c t\xednh c\u1ee7a l\u1edbp d\u1eef li\u1ec7u ",null==t.viewField?null:t.viewField.layerName,""),o.Lb(1),o.Kc("min-height",120,"px"),o.Lb(1),o.sc("externalPaging",!0)("columns",t.columnsViewField)("rows",null==t.viewField?null:t.viewField.fields)("scrollbarH",!0))},directives:[F.b,F.d,F.a,l.d,F.c,r.o],styles:[".body[_ngcontent-%COMP%]{min-height:-webkit-fit-content;min-height:-moz-fit-content;min-height:fit-content;max-height:560px;width:560px}"]}),e})();var R=c("DS98");let A=(()=>{class e{}return e.\u0275mod=o.Vb({type:e}),e.\u0275inj=o.Ub({factory:function(t){return new(t||e)},imports:[[n.c,r.H,r.p,g.g,h.p,r.k,g.b,r.lb,r.w]]}),e})(),z=(()=>{class e{}return e.\u0275mod=o.Vb({type:e}),e.\u0275inj=o.Ub({factory:function(t){return new(t||e)},imports:[[n.c,l.e,R.a,r.u,r.p,r.F,g.g,r.sb]]}),e})();var U=c("xMsH");let X=(()=>{class e{}return e.\u0275mod=o.Vb({type:e}),e.\u0275inj=o.Ub({factory:function(t){return new(t||e)},imports:[[n.c,r.gb]]}),e})(),V=(()=>{class e{}return e.\u0275mod=o.Vb({type:e}),e.\u0275inj=o.Ub({factory:function(t){return new(t||e)},imports:[[n.c,h.g,g.b,g.g,r.H,g.i,r.p,X,r.lb,r.w]]}),e})(),W=(()=>{class e{}return e.\u0275mod=o.Vb({type:e}),e.\u0275inj=o.Ub({factory:function(t){return new(t||e)},imports:[[n.c,r.u,h.g,r.H,r.F,r.w,l.e,r.p,r.sb,V,r.gb,g.b,X,g.i]]}),e})(),$=(()=>{class e{}return e.\u0275mod=o.Vb({type:e}),e.\u0275inj=o.Ub({factory:function(t){return new(t||e)},imports:[[n.c,r.u,r.H,g.i,r.p,h.g,r.lb,U.c,r.Y,g.g,r.F,r.f,d.g,r.F,r.sb,W,r.w,V,g.b]]}),e})();var q=c("4k3B");function Y(e,t){if(1&e&&(o.dc(0,"nb-option",2),o.Oc(1),o.cc()),2&e){const e=t.$implicit;o.sc("value",e),o.Lb(1),o.Qc(" ",e," ")}}let H=(()=>{class e{constructor(e){this.layerTableService=e,this.valueChange=new o.r}ngOnInit(){this.layerTableService.getColumnType().subscribe(e=>this.columnTypes=e)}}return e.\u0275fac=function(t){return new(t||e)(o.Xb(i.a))},e.\u0275cmp=o.Rb({type:e,selectors:[["app-table-column-type"]],inputs:{value:"value"},outputs:{valueChange:"valueChange"},decls:2,vars:2,consts:[["fullWidth","","placeholder","",3,"selected","selectedChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(e,t){1&e&&(o.dc(0,"nb-select",0),o.kc("selectedChange",(function(e){return t.valueChange.emit(e)})),o.Mc(1,Y,2,2,"nb-option",1),o.cc()),2&e&&(o.sc("selected",t.value),o.Lb(1),o.sc("ngForOf",t.columnTypes))},directives:[r.fb,n.t,r.W],styles:[""]}),e})(),_=(()=>{class e{constructor(e){this.toast=e,this.close=new o.r,this.entityAdd={nullable:!0},this.status={adding:!1},this.autoFill=!1}ngOnInit(){}themMoi(){try{this.checkValid()&&this.close.emit(this.entityAdd)}catch(e){this.toast.danger(e.message,"L\u1ed7i")}}checkValid(){if(!this.entityAdd.name)throw new Error("Vui l\xf2ng nh\u1eadp t\xean thu\u1ed9c t\xednh");if(!this.entityAdd.type)throw new Error("Vui l\xf2ng nh\u1eadp ki\u1ec3u d\u1eef li\u1ec7u");return!0}}return e.\u0275fac=function(t){return new(t||e)(o.Xb(r.qb))},e.\u0275cmp=o.Rb({type:e,selectors:[["ga-them-moi"]],inputs:{entityAdd:"entityAdd"},outputs:{close:"close"},decls:20,vars:12,consts:[[3,"open"],[1,"mb-3"],["nbInput","","dnInput","","placeholder","T\xean thu\u1ed9c t\xednh",3,"label","fullWidth","ngModel","ngModelChange"],["nbInput","","dnInput","","placeholder","M\xf4 t\u1ea3",3,"label","fullWidth","ngModel","ngModelChange"],[3,"value","valueChange"],[3,"disabled","checked","checkedChange"],[1,"d-flex","justify-content-end"],["nbButton","","size","small","ghost","",3,"click"],["nbButton","","size","small","type","submit","status","primary",3,"disabled","nbSpinner","click"]],template:function(e,t){1&e&&(o.dc(0,"dn-dialog",0),o.dc(1,"dn-dialog-header"),o.Oc(2,"Th\xeam m\u1edbi thu\u1ed9c t\xednh"),o.cc(),o.dc(3,"dn-dialog-body"),o.dc(4,"div",1),o.dc(5,"input",2),o.kc("ngModelChange",(function(e){return t.entityAdd.name=e})),o.cc(),o.cc(),o.dc(6,"div",1),o.dc(7,"input",3),o.kc("ngModelChange",(function(e){return t.entityAdd.alias=e})),o.cc(),o.cc(),o.dc(8,"div",1),o.dc(9,"label"),o.Oc(10,"Ki\u1ec3u d\u1eef li\u1ec7u"),o.cc(),o.dc(11,"app-table-column-type",4),o.kc("valueChange",(function(e){return t.entityAdd.type=e})),o.cc(),o.cc(),o.dc(12,"div"),o.dc(13,"nb-checkbox",5),o.kc("checkedChange",(function(e){return t.entityAdd.ai=e})),o.Oc(14,"T\u1ef1 \u0111\u1ed9ng t\u0103ng"),o.cc(),o.cc(),o.cc(),o.dc(15,"dn-dialog-footer",6),o.dc(16,"button",7),o.kc("click",(function(){return t.close.emit()})),o.Oc(17,"\u0110\xf3ng"),o.cc(),o.dc(18,"button",8),o.kc("click",(function(){return t.themMoi()})),o.Oc(19," Th\xeam m\u1edbi "),o.cc(),o.cc(),o.cc()),2&e&&(o.sc("open",!0),o.Lb(5),o.sc("label",!0)("fullWidth",!0)("ngModel",t.entityAdd.name),o.Lb(2),o.sc("label",!0)("fullWidth",!0)("ngModel",t.entityAdd.alias),o.Lb(4),o.sc("value",t.entityAdd.type),o.Lb(2),o.sc("disabled",!("int"===t.entityAdd.type||"bigint"===t.entityAdd.type||"uniqueidentifier"===t.entityAdd.type))("checked",t.entityAdd.ai),o.Lb(5),o.sc("disabled",t.status.adding)("nbSpinner",t.status.adding))},directives:[g.d,g.f,g.c,r.G,g.h,h.b,h.j,h.m,H,r.v,g.e,r.o,r.kb],styles:[""]}),e})();const E=["table"];function J(e,t){if(1&e){const e=o.ec();o.dc(0,"input",23),o.kc("ngModelChange",(function(c){return o.Dc(e),t.row.alias=c}))("ngModelChange",(function(){return t.row.isChange=!0})),o.cc()}if(2&e){const e=t.row;o.sc("fullWidth",!0)("ngModel",e.alias)}}function Q(e,t){if(1&e&&(o.dc(0,"nb-option",21),o.Oc(1),o.cc()),2&e){const e=t.$implicit;o.sc("value",e),o.Lb(1),o.Pc(e)}}function K(e,t){if(1&e){const e=o.ec();o.dc(0,"nb-select",24),o.kc("selectedChange",(function(c){return o.Dc(e),t.row.type=c}))("selectedChange",(function(){return t.row.isChange=!0})),o.Mc(1,Q,2,2,"nb-option",19),o.cc()}if(2&e){const e=t.row,c=o.mc();o.sc("selected",e.type),o.Lb(1),o.sc("ngForOf",c.columnTypes)}}function Z(e,t){if(1&e){const e=o.ec();o.dc(0,"nb-checkbox",25),o.kc("checkedChange",(function(c){o.Dc(e);const n=t.row;return n.isNullable=!c,n.isChange=!0})),o.cc()}2&e&&o.sc("checked",!t.row.isNullable)}function ee(e,t){if(1&e){const e=o.ec();o.dc(0,"dn-auto-complete",26),o.kc("valueChange",(function(c){return o.Dc(e),t.row.joinTable=c})),o.cc()}if(2&e){const e=t.row,c=o.mc();o.sc("service",c.layerService)("value",e.joinTable)}}function te(e,t){if(1&e&&(o.dc(0,"nb-option",21),o.Oc(1),o.cc()),2&e){const e=t.$implicit;o.sc("value",e.name),o.Lb(1),o.Pc(e.name)}}function ce(e,t){if(1&e){const e=o.ec();o.dc(0,"ga-them-moi",27),o.kc("close",(function(t){return o.Dc(e),o.mc().closeDlgThemMoi(t)})),o.cc()}}function ne(e,t){if(1&e){const e=o.ec();o.dc(0,"ga-xoa-bo",27),o.kc("close",(function(){return o.Dc(e),o.mc().dlgXoa=!1})),o.cc()}}let ie=(()=>{class e{constructor(e,t){this.toast=e,this.layerService=t,this.layer={},this.selectionType=l.f.single,this.GeometryTypeEnum=q.b,this.dlgThemMoi=!1,this.dlgXoa=!1,this.status={saving:!0,edit:!0,delete:!0},this.rows=[],this.selectedRows=[],this.rowsDelete=[]}get layerId(){return this._layerId}set layerId(e){e!==this._layerId&&(this._layerId=e,this.layerService.getOne(e,{fields:["geometryType"]}).subscribe(e=>{this.layer.geometryType=this.geometryType=e.geometryType}))}get isChange(){return this.rows.some(e=>e.isDelete||e.isChange||e.isNew)}get displayColumn(){return this.rows.find(e=>e.isDisplay)||this.primaryColumn}get primaryColumn(){return this.rows.find(e=>e.isPrimary)}ngOnInit(){this.loadRows(),this.layerService.getColumnType().subscribe(e=>this.columnTypes=e)}loadRows(){this.layerService.getColumns({table:this.layerId}).subscribe(e=>{this.rows=e.filter(e=>"geometry"!==e.type)})}phucHoi(){this.loadRows()}save(){return Object(b.a)(this,void 0,void 0,(function*(){try{const e=this.rows.filter(e=>!e.isDelete);yield this.layerService.syncColumn({tableName:this.layerId,columns:e}).toPromise(),this.layerService.updateDisplayColumn({tableName:this.layerId,columnDisplay:this.displayColumn.name}).subscribe({next:()=>{},error:()=>{this.toast.danger("C\xf3 l\u1ed7i x\u1ea3y ra khi c\u1eadp nh\u1eadt c\u1ed9t \u0111\u1ea1i di\u1ec7n","Th\xf4ng b\xe1o")}}),this.geometryType!==this.layer.geometryType&&this.layerService.changeGeometryType({tableName:this.layerId,geometryType:this.layer.geometryType}).subscribe({next:e=>{this.toast.success(e.message,"Th\xf4ng b\xe1o c\u1eadp nh\u1eadt ki\u1ec3u d\u1eef li\u1ec7u kh\xf4ng gian",{duration:5e3}),this.geometryType=this.layer.geometryType},error:()=>{this.toast.danger("C\xf3 l\u1ed7i x\u1ea3y ra khi thay \u0111\u1ed5i ki\u1ec3u d\u1eef li\u1ec7u kh\xf4ng gian","Th\xf4ng b\xe1o")}}),this.loadRows()}catch(e){this.toast.danger(e.message,"L\u1ed7i")}}))}closeDlgThemMoi(e){if(e){if(this.rows.some(t=>t.name===e.name))return this.toast.danger("\u0110\xe3 t\u1ed3n t\u1ea1i c\u1ed9t "+e.name,"L\u1ed7i");this.rows=[...this.rows,Object.assign(Object.assign({},e),{isNew:!0})]}this.dlgThemMoi=!1}getRowClass(e){const{isNew:t,isChange:c,isDelete:n,isPrimary:i}=e;return{"is-new-row":Boolean(t),"is-change-row":Boolean(c),"is-delete-row":Boolean(n),"is-primary-row":Boolean(i)}}removeColumns(){if(this.selectedRows.length>0){const e=[...this.rows];this.selectedRows.forEach(t=>{if(t.isNew){const c=e.findIndex(e=>e.name===t.name);c>-1&&e.splice(c,1)}t.isDelete=!0}),this.rows=e,this.selectedRows=[]}}changeDisplayColumn(e){this.rows.forEach(t=>{t.isDisplay=t.name===e})}changeGeometryType(e){!this.layer.geometryType&&e?this.toast.info("L\u1edbp d\u1eef li\u1ec7u \u0111\u01b0\u1ee3c chuy\u1ec3n \u0111\u1ed5i sang d\u1eef li\u1ec7u kh\xf4ng gian","C\u1ea3nh b\xe1o"):this.layer.geometryType!==e&&this.toast.info("L\u1edbp d\u1eef li\u1ec7u s\u1ebd \u0111\u01b0\u1ee3c chuy\u1ec3n \u0111\u1ed5i ki\u1ec3u d\u1eef li\u1ec7u, d\u1eef li\u1ec7u thu\u1ed9c t\xednh kh\xf4ng gian s\u1ebd b\u1ecb x\xf3a","C\u1ea3nh b\xe1o"),this.layer.geometryType=e}}return e.\u0275fac=function(t){return new(t||e)(o.Xb(r.qb),o.Xb(i.a))},e.\u0275cmp=o.Rb({type:e,selectors:[["app-layer-column"]],viewQuery:function(e,t){var c;1&e&&o.Sc(E,!0),2&e&&o.zc(c=o.lc())&&(t.table=c.first)},inputs:{layerId:"layerId"},decls:39,vars:23,consts:[[1,"table-layer-column"],[1,"d-flex","justify-content-between"],["size","small","nbButton","","ghost","","nbTooltip","X\xf3a","nbs","","status","danger",3,"disabled","click"],["icon","trash-outline"],["size","small","nbButton","","ghost","","nbTooltip","Ph\u1ee5c h\u1ed3i","status","basic",3,"disabled","click"],["icon","backspace-outline"],["size","small","nbButton","","ghost","","nbTooltip","Th\xeam m\u1edbi","status","primary",3,"click"],["icon","plus-outline"],["columnMode","force","selectionType","checkbox",1,"material",3,"rows","footerHeight","scrollbarH","rowClass","selected","selectedChange"],["table",""],["prop","name","name","T\xean","type","string",3,"width"],["prop","alias","name","M\xf4 t\u1ea3","type","string",3,"width"],["ngn-datatable-cell-template",""],["prop","type","name","Ki\u1ec3u d\u1eef li\u1ec7u","type","number",3,"width"],["prop","isNullable","name","Kh\xf4ng tr\u1ed1ng",3,"width"],["prop","joinTable","name","Quan h\u1ec7",3,"width"],[1,"row"],[1,"col-md-6","col-lg-4","col-xs-12"],["size","tiny","fullWidth","","placeholder","Thu\u1ed9c t\xednh \u0111\u1ea1i di\u1ec7n","dnInput","",3,"label","selected","selectedChange"],[3,"value",4,"ngFor","ngForOf"],["size","tiny","fullWidth","","placeholder","Lo\u1ea1i kh\xf4ng gian","dnInput","",3,"label","selected","selectedChange"],[3,"value"],[3,"close",4,"ngIf"],["nbInput","","placeholder","M\xf4 t\u1ea3","fieldSize","tiny",3,"fullWidth","ngModel","ngModelChange"],["size","tiny","fullWidth","",3,"selected","selectedChange"],["size","tiny",3,"checked","checkedChange"],["fieldName","layerName","fieldValue","layerId","fieldSize","tiny",3,"service","value","valueChange"],[3,"close"]],template:function(e,t){1&e&&(o.dc(0,"nb-card",0),o.dc(1,"nb-card-header",1),o.dc(2,"span"),o.Oc(3,"Qu\u1ea3n l\xfd thu\u1ed9c t\xednh"),o.cc(),o.dc(4,"div"),o.dc(5,"button",2),o.kc("click",(function(){return t.removeColumns()})),o.Yb(6,"nb-icon",3),o.cc(),o.dc(7,"button",4),o.kc("click",(function(){return t.phucHoi()})),o.Yb(8,"nb-icon",5),o.cc(),o.dc(9,"button",6),o.kc("click",(function(){return t.dlgThemMoi=!0})),o.Yb(10,"nb-icon",7),o.cc(),o.cc(),o.cc(),o.dc(11,"nb-card-body"),o.dc(12,"ngn-datatable",8,9),o.kc("selectedChange",(function(e){return t.selectedRows=e})),o.Yb(14,"ngn-datatable-column",10),o.dc(15,"ngn-datatable-column",11),o.Mc(16,J,1,2,"ng-template",12),o.cc(),o.dc(17,"ngn-datatable-column",13),o.Mc(18,K,2,2,"ng-template",12),o.cc(),o.dc(19,"ngn-datatable-column",14),o.Mc(20,Z,1,1,"ng-template",12),o.cc(),o.dc(21,"ngn-datatable-column",15),o.Mc(22,ee,1,2,"ng-template",12),o.cc(),o.cc(),o.dc(23,"div",16),o.dc(24,"div",17),o.dc(25,"nb-select",18),o.kc("selectedChange",(function(e){return t.changeDisplayColumn(e)})),o.Mc(26,te,2,2,"nb-option",19),o.cc(),o.cc(),o.dc(27,"div",17),o.dc(28,"nb-select",20),o.kc("selectedChange",(function(e){return t.changeGeometryType(e)})),o.dc(29,"nb-option",21),o.Oc(30,"Kh\xf4ng ph\u1ea3i l\u1edbp kh\xf4ng gian"),o.cc(),o.dc(31,"nb-option",21),o.Oc(32,"\u0110i\u1ec3m"),o.cc(),o.dc(33,"nb-option",21),o.Oc(34,"\u0110\u01b0\u1eddng"),o.cc(),o.dc(35,"nb-option",21),o.Oc(36,"V\xf9ng"),o.cc(),o.cc(),o.cc(),o.cc(),o.cc(),o.cc(),o.Mc(37,ce,1,0,"ga-them-moi",22),o.Mc(38,ne,1,0,"ga-xoa-bo",22)),2&e&&(o.Lb(5),o.sc("disabled",!t.selectedRows.length),o.Lb(2),o.sc("disabled",!t.isChange),o.Lb(5),o.sc("rows",t.rows)("footerHeight",50)("scrollbarH",!0)("rowClass",t.getRowClass)("selected",t.selectedRows),o.Lb(2),o.sc("width",200),o.Lb(1),o.sc("width",250),o.Lb(2),o.sc("width",120),o.Lb(2),o.sc("width",50),o.Lb(2),o.sc("width",150),o.Lb(4),o.sc("label",!0)("selected",null==t.displayColumn?null:t.displayColumn.name),o.Lb(1),o.sc("ngForOf",t.rows),o.Lb(2),o.sc("label",!0)("selected",t.geometryType),o.Lb(1),o.sc("value",null),o.Lb(2),o.sc("value",t.GeometryTypeEnum.Point),o.Lb(2),o.sc("value",t.GeometryTypeEnum.Polyline),o.Lb(2),o.sc("value",t.GeometryTypeEnum.Polygon),o.Lb(2),o.sc("ngIf",t.dlgThemMoi),o.Lb(1),o.sc("ngIf",t.dlgXoa))},directives:[r.r,r.t,r.o,r.rb,r.D,r.q,l.d,l.c,l.b,r.fb,g.h,n.t,r.W,n.u,r.G,h.b,h.j,h.m,r.v,g.a,_],styles:[".table-layer-column[_ngcontent-%COMP%]     .ngn-datatable .is-primary-row{border:1px solid #ffdd59}.table-layer-column[_ngcontent-%COMP%]     .ngn-datatable .is-new-row{background-color:#55efc4}.table-layer-column[_ngcontent-%COMP%]     .ngn-datatable .is-change-row{background-color:#fd79a8}.table-layer-column[_ngcontent-%COMP%]     .ngn-datatable .is-delete-row{background-color:#ff7675}"]}),e})();function le(e,t){if(1&e){const e=o.ec();o.dc(0,"button",26),o.kc("click",(function(){return o.Dc(e),o.mc(2).exampleRendererSimple({type:"point"})})),o.Oc(1," Point "),o.cc(),o.dc(2,"button",26),o.kc("click",(function(){return o.Dc(e),o.mc(2).exampleRendererSimple({type:"polyline"})})),o.Oc(3," Polyline "),o.cc(),o.dc(4,"button",26),o.kc("click",(function(){return o.Dc(e),o.mc(2).exampleRendererSimple({type:"polygon"})})),o.Oc(5," Polygon "),o.cc()}}function ae(e,t){if(1&e){const e=o.ec();o.dc(0,"button",26),o.kc("click",(function(){return o.Dc(e),o.mc(2).exampleRendererUnique({type:"point"})})),o.Oc(1," Point "),o.cc(),o.dc(2,"button",26),o.kc("click",(function(){return o.Dc(e),o.mc(2).exampleRendererUnique({type:"polyline"})})),o.Oc(3," Polyline "),o.cc(),o.dc(4,"button",26),o.kc("click",(function(){return o.Dc(e),o.mc(2).exampleRendererUnique({type:"polygon"})})),o.Oc(5," Polygon "),o.cc()}}function se(e,t){if(1&e&&(o.dc(0,"nb-accordion-item"),o.dc(1,"nb-accordion-item-header"),o.Oc(2,"Thu\u1ed9c t\xednh"),o.cc(),o.dc(3,"nb-accordion-item-body"),o.Yb(4,"app-layer-column",27),o.cc(),o.cc()),2&e){const e=o.mc(2);o.Lb(4),o.sc("layerId",e.layerId)}}function oe(e,t){if(1&e){const e=o.ec();o.dc(0,"button",28),o.kc("click",(function(){return o.Dc(e),o.mc(2).dlgCreateTable=!0})),o.Yb(1,"nb-icon",25),o.Oc(2," T\u1ea1o b\u1ea3ng "),o.cc()}if(2&e){const e=o.mc(2);o.sc("nbSpinner",e.status.isCraeteTable)("disabled",e.status.isCraeteTable)}}const re=function(){return["../.."]};function de(e,t){if(1&e){const e=o.ec();o.dc(0,"dn-dialog",2),o.dc(1,"dn-dialog-header",3),o.dc(2,"span"),o.Oc(3," Th\xf4ng tin l\u1edbp d\u1eef li\u1ec7u "),o.cc(),o.dc(4,"div"),o.dc(5,"button",4),o.Yb(6,"nb-icon",5),o.cc(),o.cc(),o.cc(),o.dc(7,"dn-dialog-body"),o.dc(8,"nb-accordion"),o.dc(9,"nb-accordion-item"),o.dc(10,"nb-accordion-item-header"),o.Oc(11,"Th\xf4ng tin l\u1edbp d\u1eef li\u1ec7u"),o.cc(),o.dc(12,"nb-accordion-item-body"),o.dc(13,"div",6),o.dc(14,"div",7),o.dc(15,"input",8),o.kc("ngModelChange",(function(t){return o.Dc(e),o.mc().value.layerId=t})),o.cc(),o.cc(),o.dc(16,"div",7),o.dc(17,"input",9),o.kc("ngModelChange",(function(t){return o.Dc(e),o.mc().value.layerName=t})),o.cc(),o.cc(),o.dc(18,"div",7),o.dc(19,"dn-auto-complete",10),o.kc("valueChange",(function(t){return o.Dc(e),o.mc().value.datasetId=t})),o.cc(),o.cc(),o.dc(20,"div",11),o.dc(21,"div",12),o.dc(22,"input",13),o.kc("ngModelChange",(function(t){return o.Dc(e),o.mc().value.url=t})),o.cc(),o.dc(23,"nb-checkbox",14),o.kc("checkedChange",(function(t){return o.Dc(e),o.mc().value.isApi=t})),o.Oc(24,"API"),o.cc(),o.cc(),o.cc(),o.cc(),o.cc(),o.cc(),o.dc(25,"nb-accordion-item"),o.dc(26,"nb-accordion-item-header"),o.Oc(27,"C\u1ea5u h\xecnh l\u1edbp d\u1eef li\u1ec7u"),o.cc(),o.dc(28,"nb-accordion-item-body"),o.dc(29,"button",15),o.kc("click",(function(){return o.Dc(e),o.mc().example()})),o.Oc(30,"Tham kh\u1ea3o"),o.cc(),o.dc(31,"button",16),o.Oc(32," Renderer Simple "),o.Mc(33,le,6,0,"ng-template",null,17,o.Nc),o.cc(),o.dc(35,"button",16),o.Oc(36," Renderer Unique "),o.Mc(37,ae,6,0,"ng-template",null,18,o.Nc),o.cc(),o.dc(39,"json-editor",19,20),o.kc("ngModelChange",(function(t){return o.Dc(e),o.mc().value.config=t})),o.cc(),o.cc(),o.cc(),o.Mc(41,se,5,1,"nb-accordion-item",21),o.cc(),o.cc(),o.dc(42,"dn-dialog-footer",22),o.Mc(43,oe,3,2,"button",23),o.dc(44,"button",24),o.kc("click",(function(){return o.Dc(e),o.mc().save()})),o.Yb(45,"nb-icon",25),o.Oc(46," L\u01b0u "),o.cc(),o.cc(),o.cc()}if(2&e){const e=o.Ac(34),t=o.Ac(38),c=o.mc();o.sc("open",!0),o.Lb(5),o.sc("routerLink",o.uc(19,re)),o.Lb(10),o.sc("label",!0)("ngModel",c.value.layerId),o.Lb(2),o.sc("label",!0)("ngModel",c.value.layerName),o.Lb(2),o.sc("service",c.datasetService)("value",c.value.datasetId)("fullWidth",!0),o.Lb(3),o.sc("ngModel",c.value.url),o.Lb(1),o.sc("checked",c.value.isApi),o.Lb(8),o.sc("nbPopover",e),o.Lb(4),o.sc("nbPopover",t),o.Lb(4),o.sc("options",c.editorOptions)("ngModel",c.value.config),o.Lb(2),o.sc("ngIf",c.hasTable),o.Lb(2),o.sc("ngIf",!c.hasTable),o.Lb(1),o.sc("nbSpinner",c.status.isSaving)("disabled",c.status.isSaving)}}const ue=function(){return{name:"OBJECTID",type:"int",alias:"ObjectId"}};function he(e,t){if(1&e){const e=o.ec();o.dc(0,"ga-them-moi",29),o.kc("close",(function(t){o.Dc(e);const c=o.mc();return t&&c.createTable(t)})),o.cc()}2&e&&o.sc("entityAdd",o.uc(1,ue))}let be=(()=>{class e{constructor(e,t,c,n){this.route=e,this.layerService=t,this.toast=c,this.datasetService=n,this.legends=[],this.editorOptions=new U.b,this.hasTable=!1,this.dlgCreateTable=!1,this.status={isSaving:!1,isCreateTable:!1}}ngOnInit(){if(this.editorOptions.mode="code",this.editorOptions.modes=["code","tree"],this.layerId=this.route.snapshot.paramMap.get("id"),!this.layerId)throw new Error("Kh\xf4ng x\xe1c nh\u1eadn \u0111\u01b0\u1ee3c param layerId");this.loadData(this.layerId),this.layerService.hasTable({table:this.layerId}).subscribe(e=>{this.hasTable=e.has})}loadData(e){this.layerService.getOne(e,{fields:["layerId","layerName","config","url","isApi","datasetId"]}).subscribe(e=>{this.value=e})}save(){return Object(b.a)(this,void 0,void 0,(function*(){try{this.status.isSaving=!0,yield this.layerService.patch(this.value.layerId,this.value).toPromise(),yield this.layerColumnRef.save(),this.toast.success("L\u01b0u th\xe0nh c\xf4ng","Th\xf4ng b\xe1o")}catch(e){this.toast.danger(e.message,"L\u1ed7i")}finally{this.status.isSaving=!1}}))}example(){this.value.config={minZoom:null,maxZoom:null,renderer:{type:"",symbol:{}}}}exampleRendererSimple(e){const t=this.getSymbol(e.type);this.value.config=Object.assign(Object.assign({},this.value.config),{renderer:{type:"simple",symbol:t}})}exampleRendererUnique(e){const{type:t}=e;this.value.config||(this.value.config={});const c=this.getSymbol(t);this.value.config=Object.assign(Object.assign({},this.value.config),{renderer:{type:"unique",field:"",defaultSymbol:c,values:[{value:null,symbol:c}]}})}getSymbol(e){return"point"===e?{type:"picture-marker",url:"",width:20,height:20}:{type:"polygon"===e?"simple-fill":"simple-line",color:"#000",fill:!0,stroke:!0,fillColor:"#000",fillOpacity:1,opacity:1}}close(){}createTable(e){!this.hasTable&&this.layerId&&e&&(this.toast.info("H\u1ec7 th\u1ed1ng \u0111ang ghi nh\u1eadn, vui l\xf2ng \u0111\u1ee3i!","Th\xf4ng b\xe1o"),this.status.isCreateTable=!0,this.layerService.createTable({table:{name:this.layerId,columns:[Object.assign(Object.assign({},e),{isPrimary:!0})]}}).pipe(Object(m.a)(()=>this.status.isCreateTable=!1)).subscribe({next:()=>{this.toast.success("B\u1ea3ng \u0111\xe3 \u0111\u01b0\u1ee3c \u0111\u1ed3ng b\u1ed9 v\xe0o c\u01a1 s\u1edf d\u1eef li\u1ec7u"),this.hasTable=!0,this.dlgCreateTable=!1},error:e=>{this.toast.danger(e.message,"L\u1ed7i")}}))}}return e.\u0275fac=function(t){return new(t||e)(o.Xb(d.a),o.Xb(i.a),o.Xb(r.qb),o.Xb(s.a))},e.\u0275cmp=o.Rb({type:e,selectors:[["app-layer-config"]],viewQuery:function(e,t){var c;1&e&&o.Sc(ie,!0),2&e&&o.zc(c=o.lc())&&(t.layerColumnRef=c.first)},decls:2,vars:2,consts:[["width","100vw",3,"open",4,"ngIf"],[3,"entityAdd","close",4,"ngIf"],["width","100vw",3,"open"],[1,"d-flex","justify-content-between","align-items-center"],["nbButton","","ghost","","status","danger","size","small","nbTooltip","\u0110\xf3ng",3,"routerLink"],["icon","close"],[1,"row"],[1,"col-xs-12","col-md-6","p-1"],["nbInput","","fieldSize","small","type","text","fullWidth","","placeholder","M\xe3","disabled","","dnInput","",3,"label","ngModel","ngModelChange"],["nbInput","","fieldSize","small","type","text","dnInput","","fullWidth","","id","layerName","placeholder","T\xean l\u1edbp",3,"label","ngModel","ngModelChange"],["fieldSize","small","fieldName","datasetName","fieldValue","datasetId",3,"service","value","fullWidth","valueChange"],[1,"col-md-12","p-1"],[1,"d-flex"],["nbInput","","fieldSize","small","placeholder","\u0110\u01b0\u1eddng d\u1eabn","fullWidth","",1,"flex-grow-1","pr-1",3,"ngModel","ngModelChange"],[1,"pl-1",3,"checked","checkedChange"],["nbButton","","size","small",3,"click"],["nbButton","","size","small",3,"nbPopover"],["popsimp",""],["popUni",""],[1,"editor",3,"options","ngModel","ngModelChange"],["editor",""],[4,"ngIf"],[1,"d-flex","justify-content-end"],["nbButton","","status","primary","size","small","outline","",3,"nbSpinner","disabled","click",4,"ngIf"],["nbButton","","status","primary","size","small",3,"nbSpinner","disabled","click"],["icon","save-outline"],["nbButton","","size","tiny",3,"click"],[3,"layerId"],["nbButton","","status","primary","size","small","outline","",3,"nbSpinner","disabled","click"],[3,"entityAdd","close"]],template:function(e,t){1&e&&(o.Mc(0,de,47,20,"dn-dialog",0),o.Mc(1,he,1,2,"ga-them-moi",1)),2&e&&(o.sc("ngIf",t.value),o.Lb(1),o.sc("ngIf",t.dlgCreateTable))},directives:[n.u,g.d,g.f,r.o,r.rb,d.d,r.D,g.c,r.b,r.d,r.e,r.c,r.G,g.h,h.b,h.j,h.m,g.a,r.v,r.X,U.a,g.e,r.kb,ie,_],styles:[".jsoneditor-mode-code{height:1000px}.legend-container[_ngcontent-%COMP%]{margin-left:30px}.legend-container[_ngcontent-%COMP%]   .legend-item[_ngcontent-%COMP%]{display:flex;align-items:center}.legend-container[_ngcontent-%COMP%]   .legend-item__icon[_ngcontent-%COMP%]{width:20px;height:20px}.legend-container[_ngcontent-%COMP%]   .legend-item__text[_ngcontent-%COMP%]{flex:1;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;font-size:12px}"]}),e})(),ge=(()=>{class e{}return e.\u0275mod=o.Vb({type:e}),e.\u0275inj=o.Ub({factory:function(t){return new(t||e)},imports:[[n.c,r.u,r.p,r.H,r.lb,r.k,h.g,r.sb,r.sb,N.a,x.a,l.e,G,R.a,r.F,A,z,$,g.g,d.g.forChild([{path:"",component:B,children:[{path:":layerId/field",component:P},{path:"detail/:id",component:be}]},{path:"gdb",loadChildren:()=>c.e(13).then(c.bind(null,"45ZY")).then(e=>e.LayerGdbModule)}])],d.g]}),e})()},bANk:function(e,t,c){"use strict";c.d(t,"a",(function(){return s}));var n=c("AytR"),i=c("WJ/N"),l=c("fXoL"),a=c("tk/3");let s=(()=>{class e extends i.a{constructor(e){super({apiUrl:n.a.apiUrl,entity:"sys/layer"},e)}getManyGDB(e){return this.http.get(this.getBaseUrl()+"/gdb",{params:this.getParamsFromQuery(e)})}getOneGDB(e){return this.http.get(this.getBaseUrl()+"/gdb/"+e)}updateDatasetName(e,t){return this.http.post(this.getBaseUrl()+"/gdb/alias/"+e,{layerName:t})}getFields(e){return this.http.get(this.getBaseUrl()+`/gdb/${e}/field`)}updateField(e,t,c){return this.http.post(this.getBaseUrl()+`/gdb/${e}/field/${t}`,c)}updateAliasNameFromGDB(e){return this.http.patch(this.getBaseUrl()+"/aliasfromgdb",{lstLayerId:e},{headers:{"Content-Type":"application/json"}})}getColumnType(){return this.http.get(this.getBaseUrl()+"/columndatatype")}getColumns(e){return this.http.get(`${this.getBaseUrl()}/column/${e.table}`)}hasTable(e){return this.http.get(`${this.getBaseUrl()}/hastable/${e.table}`)}createTable(e){return this.http.post(this.getBaseUrl()+"/createtable",JSON.stringify(e.table),{headers:{"content-type":"application/json"}})}addColumn(e){return this.http.post(`${this.getBaseUrl()}/addcolumn/${e.tableName}`,JSON.stringify(e.column),{headers:{"content-type":"application/json"}})}dropColumn(e){return this.http.delete(`${this.getBaseUrl()}/dropColumn/${e.tableName}/${e.columnName}`)}syncColumn(e){return this.http.patch(`${this.getBaseUrl()}/synccolumn/${e.tableName}`,JSON.stringify(e.columns),{headers:{"content-type":"application/json"}})}updateDisplayColumn(e){return this.http.patch(`${this.getBaseUrl()}/columnDisplay/${e.tableName}`,JSON.stringify({columnDisplay:e.columnDisplay}),{headers:{"content-type":"application/json"}})}changeGeometryType(e){return this.http.patch(`${this.getBaseUrl()}/geometrytype/${e.tableName}`,JSON.stringify({geometryType:e.geometryType}),{headers:{"content-type":"application/json"}})}}return e.\u0275fac=function(t){return new(t||e)(l.hc(a.b))},e.\u0275prov=l.Tb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()}}]);