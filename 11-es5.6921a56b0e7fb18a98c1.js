!function(){function e(e){return function(e){if(Array.isArray(e))return t(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,n){if(!e)return;if("string"==typeof e)return t(e,n);var c=Object.prototype.toString.call(e).slice(8,-1);"Object"===c&&e.constructor&&(c=e.constructor.name);if("Map"===c||"Set"===c)return Array.from(e);if("Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return t(e,n)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,c=new Array(t);n<t;n++)c[n]=e[n];return c}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var n=0;n<t.length;n++){var c=t[n];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(e,c.key,c)}}function i(e,t,n){return t&&c(e.prototype,t),n&&c(e,n),e}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function o(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,c=s(e);if(t){var i=s(this).constructor;n=Reflect.construct(c,arguments,i)}else n=c.apply(this,arguments);return r(this,n)}}function r(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{"4k3B":function(e,t,n){"use strict";n.d(t,"a",(function(){return c})),n.d(t,"b",(function(){return i}));var c=function(e){return e.string="esriFieldTypeString",e.smallInteger="esriFieldTypeSmallInteger",e.integer="esriFieldTypeInteger",e.double="esriFieldTypeDouble",e.long="esriFieldTypeLong",e.date="esriFieldTypeDate",e.oid="esriFieldTypeOID",e.geometry="esriFieldTypeGeometry",e}({}),i=function(e){return e.Point="GeometryPoint",e.MultiPoint="GeometryMultipoint",e.Polyline="GeometryPolyline",e.Polygon="GeometryPolygon",e}({})},CjdU:function(e,t,c){"use strict";c.d(t,"a",(function(){return h}));var l=c("AytR"),r=c("i/XZ"),s=c("Zt20"),u=c("fXoL"),d=c("tk/3"),h=function(){var e=function(e){a(c,e);var t=o(c);function c(e){return n(this,c),t.call(this,{apiUrl:l.a.apiUrl,entity:"sys/dataset"},e)}return i(c,[{key:"getGDBNotExists",value:function(){var e=s.a.create({filter:[{field:"notExist",operator:"$eq",value:!0}]});return this.http.get(this.getBaseUrl()+"/gdb",{params:this.getParamsFromQuery(e)})}},{key:"getManyGDB",value:function(){return this.http.get(this.getBaseUrl()+"/gdb")}},{key:"updateDatasetName",value:function(e,t){return this.http.post(this.getBaseUrl()+"/gdb/alias/"+e,{datasetName:t})}},{key:"updateAliasNameFromGDB",value:function(e){return this.http.patch(this.getBaseUrl()+"/aliasfromgdb",{lstDatasetId:e},{headers:{"Content-Type":"application/json"}})}}]),c}(r.a);return e.\u0275fac=function(t){return new(t||e)(u.hc(d.b))},e.\u0275prov=u.Tb({token:e,factory:e.\u0275fac,providedIn:"root"}),e}()},XdKL:function(t,c,a){"use strict";a.r(c),a.d(c,"LayerModule",(function(){return Ge}));var l,o=a("ofXK"),r=a("bANk"),s=a("ExIg"),u=a("advQ"),d=a("CjdU"),h=a("fXoL"),f=a("aceb"),b=a("tyNb"),p=a("wnGv"),g=a("3Pt+"),m=a("mrSG"),y=a("VmTv"),v=((l=function(){function e(t,c,i){n(this,e),this.toast=t,this.layerService=c,this.datasetService=i,this.close=new h.r,this.form=new g.e({datasetId:new g.c("",[g.s.required]),layerId:new g.c("",[g.s.required,g.s.minLength(5)]),layerName:new g.c("",[g.s.required,g.s.minLength(5)]),url:new g.c("",[g.s.required,g.s.minLength(5)]),isApi:new g.c(!1)}),this.status={saving:!1}}return i(e,[{key:"ngOnInit",value:function(){}},{key:"submit",value:function(){return Object(m.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.form.valid){e.next=15;break}return e.prev=1,this.status.saving=!0,e.next=5,this.layerService.create(this.form.value).toPromise();case 5:this.toast.success("Th\xeam th\xe0nh c\xf4ng"),this.form.reset({datasetId:this.form.get("datasetId").value}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),this.toast.danger(e.t0.message,"L\u1ed7i");case 12:return e.prev=12,this.status.saving=!1,e.finish(12);case 15:case"end":return e.stop()}}),e,this,[[1,9,12,15]])})))}}]),e}()).\u0275fac=function(e){return new(e||l)(h.Xb(f.qb),h.Xb(r.a),h.Xb(d.a))},l.\u0275cmp=h.Rb({type:l,selectors:[["app-them-moi-layer"]],outputs:{close:"close"},decls:22,vars:14,consts:[[3,"open"],[3,"formGroup","ngSubmit"],[1,"row"],[1,"col-md-12"],["fieldSize","small","fieldName","datasetName","fieldValue","datasetId",3,"service","fullWidth","valueChange"],[1,"col-md-6","col-xs-12","mb-1","mt-1"],["nbInput","","fieldSize","small","placeholder","M\xe3","formControlName","layerId",3,"tabIndex","fullWidth","status"],["nbInput","","fieldSize","small","placeholder","T\xean","formControlName","layerName",3,"fullWidth","status"],[1,"col-md-12","mb-1","mt-1"],[1,"d-flex"],["nbInput","","fieldSize","small","placeholder","\u0110\u01b0\u1eddng d\u1eabn","formControlName","url",1,"flex-1","pr-1",3,"fullWidth","status"],["formControlName","isApi",1,"pl-1",3,"status"],[1,"d-flex","justify-content-end"],["nbButton","","size","small","ghost","",3,"click"],["nbButton","","size","small","type","submit",3,"disabled","nbSpinner"]],template:function(e,t){1&e&&(h.dc(0,"dn-dialog",0),h.dc(1,"dn-dialog-header"),h.Oc(2,"Th\xeam m\u1edbi l\u1edbp d\u1eef li\u1ec7u"),h.cc(),h.dc(3,"dn-dialog-body"),h.dc(4,"form",1),h.kc("ngSubmit",(function(){return t.submit()})),h.dc(5,"div",2),h.dc(6,"div",3),h.dc(7,"dn-auto-complete",4),h.kc("valueChange",(function(e){return t.form.get("datasetId").setValue(e)})),h.cc(),h.cc(),h.dc(8,"div",5),h.Yb(9,"input",6),h.cc(),h.dc(10,"div",5),h.Yb(11,"input",7),h.cc(),h.dc(12,"div",8),h.dc(13,"div",9),h.Yb(14,"input",10),h.dc(15,"nb-checkbox",11),h.Oc(16,"API"),h.cc(),h.cc(),h.cc(),h.cc(),h.dc(17,"dn-dialog-footer",12),h.dc(18,"button",13),h.kc("click",(function(){return t.close.emit()})),h.Oc(19,"\u0110\xf3ng"),h.cc(),h.dc(20,"button",14),h.Oc(21," Th\xeam m\u1edbi "),h.cc(),h.cc(),h.cc(),h.cc(),h.cc()),2&e&&(h.sc("open",!0),h.Lb(4),h.sc("formGroup",t.form),h.Lb(3),h.sc("service",t.datasetService)("fullWidth",!0),h.Lb(2),h.sc("tabIndex",1)("fullWidth",!0)("status",t.form.get("layerId").touched&&t.form.get("layerId").invalid?"danger":"basic"),h.Lb(2),h.sc("fullWidth",!0)("status",t.form.get("layerName").touched&&t.form.get("layerName").invalid?"danger":"basic"),h.Lb(3),h.sc("fullWidth",!0)("status",t.form.get("url").touched&&t.form.get("url").invalid?"danger":"basic"),h.Lb(1),h.sc("status",t.form.get("isApi").touched&&t.form.get("isApi").invalid?"danger":"basic"),h.Lb(5),h.sc("disabled",!t.form.valid)("nbSpinner",t.status.saving))},directives:[y.d,y.f,y.c,g.u,g.k,g.f,y.a,f.G,g.b,g.j,g.d,f.v,y.e,f.o,f.kb],styles:[""]}),l),k=a("nYR2");function w(e,t){if(1&e&&(h.dc(0,"p",14),h.Oc(1),h.cc()),2&e){var n=t.value;h.sc("nbTooltip",n),h.Lb(1),h.Pc(n)}}function C(e,t){if(1&e&&(h.dc(0,"p",14),h.Oc(1),h.cc()),2&e){var n=t.value;h.sc("nbTooltip",n),h.Lb(1),h.Pc(n)}}var T,D=function(){return{fieldValue:"datasetId",fieldName:"datasetName"}},I=((T=function(){function t(e,c,i){n(this,t),this.layerService=e,this.datasetService=c,this.toast=i,this.close=new h.r,this.lstGDBRow=[],this.lstTmpGDBRow=[],this.lstDatasetGDB=[],this.lstDatasetIdGDBSelected=[],this.lstLayerSelected=[],this.isSync=!1}return i(t,[{key:"ngOnInit",value:function(){var e=this;this.loadLayerGDB(),this.datasetService.getManyGDB().subscribe((function(t){return e.lstDatasetGDB=t}))}},{key:"loadLayerGDB",value:function(){var t=this;this.layerService.getManyGDB({filter:[{field:"notExist",value:!0,operator:"$eq"}]}).subscribe((function(n){t.lstGDBRow=n,t.lstTmpGDBRow=e(n),t.filterGDB()}))}},{key:"filterGDB",value:function(){var e=this;if(this.lstDatasetIdGDBSelected.length){var t=this.lstTmpGDBRow.filter((function(t){return e.lstDatasetIdGDBSelected.indexOf(t.datasetId)>-1}));this.lstGDBRow=t}}},{key:"syncFromGDB",value:function(e){var t=this;this.isSync=!0,this.layerService.createMany(e).pipe(Object(k.a)((function(){return t.isSync=!1}))).subscribe((function(){t.toast.success("\u0110\xe3 chuy\u1ec3n d\u1eef li\u1ec7u sang danh s\xe1ch qu\u1ea3n l\xfd","Th\xe0nh c\xf4ng"),t.loadLayerGDB(),t.lstLayerSelected=[]}),(function(e){return t.toast.danger(e||"C\xf3 l\u1ed7i x\u1ea3y ra","L\u1ed7i")}))}},{key:"bulkClick",value:function(e){var t=this;"update"===e.action.name&&this.lstLayerSelected.length&&this.layerService.updateAliasNameFromGDB(this.lstLayerSelected.map((function(e){return e.layerId}))).subscribe((function(e){t.toast.success("C\u1eadp nh\u1eadt th\xe0nh c\xf4ng","Th\xe0nh c\xf4ng")}),(function(e){return t.toast.danger(e)}))}}]),t}()).\u0275fac=function(e){return new(e||T)(h.Xb(r.a),h.Xb(d.a),h.Xb(f.qb))},T.\u0275cmp=h.Rb({type:T,selectors:[["app-from-gdb"]],outputs:{close:"close"},decls:21,vars:10,consts:[["width","100vw","maxWidth","100vw",3,"open"],[1,"d-flex","justify-content-between"],["nbButton","","size","small","ghost","","nbTooltip","T\u1ea3i l\u1ea1i",3,"click"],["icon","refresh"],["nbButton","","size","small","ghost","","nbTooltip","\u0110\xf3ng","status","danger",3,"click"],["icon","close"],["fullWidth","","multiple","","placeholder","Ch\u1ecdn dataset",3,"lstValue","config","value","valueChange"],["selectionType","checkbox",1,"material","mt-2",3,"rows","limit","selected","footerHeight","bulkClick","select"],["tableGDB",""],["minWidth","100","name","M\xe3","prop","layerId"],["ngn-datatable-cell-template",""],["minWidth","400","name","T\xean","prop","layerName"],[1,"d-flex","justify-content-end"],["nbButton","","outline","","size","small","status","primary","tabindex","0","nbTooltip","Chuy\u1ec3n d\u1eef li\u1ec7u \u0111\u1ec3 cung c\u1ea5p cho c\xe1c \u1ee9ng d\u1ee5ng",3,"disabled","click"],[3,"nbTooltip"]],template:function(e,t){if(1&e){var n=h.ec();h.dc(0,"dn-dialog",0),h.dc(1,"dn-dialog-header",1),h.dc(2,"span"),h.Oc(3,"L\u1edbp d\u1eef li\u1ec7u t\u1eeb GDB"),h.cc(),h.dc(4,"div"),h.dc(5,"button",2),h.kc("click",(function(){return t.loadLayerGDB()})),h.Yb(6,"nb-icon",3),h.cc(),h.dc(7,"button",4),h.kc("click",(function(){return t.close.emit()})),h.Yb(8,"nb-icon",5),h.cc(),h.cc(),h.cc(),h.dc(9,"dn-dialog-body"),h.dc(10,"ga-select",6),h.kc("valueChange",(function(e){return t.lstDatasetIdGDBSelected=e}))("valueChange",(function(){return t.filterGDB()})),h.cc(),h.dc(11,"ngn-datatable",7,8),h.kc("bulkClick",(function(e){return t.bulkClick(e)}))("select",(function(e){return t.lstLayerSelected=e.selected})),h.dc(13,"ngn-datatable-column",9),h.Mc(14,w,2,2,"ng-template",10),h.cc(),h.dc(15,"ngn-datatable-column",11),h.Mc(16,C,2,2,"ng-template",10),h.cc(),h.cc(),h.cc(),h.dc(17,"dn-dialog-footer",12),h.dc(18,"button",13),h.kc("click",(function(){h.Dc(n);var e=h.Ac(12);return t.syncFromGDB(e.selected)})),h.Oc(19," Chuy\u1ec3n d\u1eef li\u1ec7u "),h.cc(),h.Oc(20,"` "),h.cc(),h.cc()}if(2&e){var c=h.Ac(12);h.sc("open",!0),h.Lb(10),h.sc("lstValue",t.lstDatasetGDB)("config",h.uc(9,D))("value",t.lstDatasetIdGDBSelected),h.Lb(1),h.sc("rows",t.lstGDBRow)("limit",10)("selected",t.lstLayerSelected)("footerHeight",50),h.Lb(7),h.sc("disabled",!c.selected.length||t.isSync)}},directives:[y.d,y.f,f.o,f.rb,f.D,y.c,p.a,s.d,s.c,s.b,y.e],styles:[""]}),T),S=["table"],O=["cellTplLayerName"],L=["celxTplLayerName"];function M(e,t){if(1&e){var n=h.ec();h.dc(0,"input",16),h.kc("ngModelChange",(function(e){return h.Dc(n),t.row.layerName=e}))("change",(function(){h.Dc(n);var e=t.row;return h.mc().update(e)})),h.cc()}2&e&&h.sc("ngModel",t.row.layerName)}function B(e,t){if(1&e){var n=h.ec();h.dc(0,"input",16),h.kc("ngModelChange",(function(e){return h.Dc(n),t.row.stt=e}))("change",(function(){h.Dc(n);var e=t.row;return h.mc().update(e)})),h.cc()}2&e&&h.sc("ngModel",t.row.stt)}function x(e,t){if(1&e){var n=h.ec();h.dc(0,"input",16),h.kc("ngModelChange",(function(e){return h.Dc(n),t.row.url=e}))("change",(function(){h.Dc(n);var e=t.row;return h.mc().update(e)})),h.cc()}2&e&&h.sc("ngModel",t.row.url)}function N(e,t){if(1&e){var n=h.ec();h.dc(0,"app-them-moi-layer",17),h.kc("close",(function(){return h.Dc(n),h.mc().dlgThemMoiLayer=!1})),h.cc()}}function G(e,t){if(1&e){var n=h.ec();h.dc(0,"app-from-gdb",17),h.kc("close",(function(){return h.Dc(n),h.mc().isDlgFromGDB=!1})),h.cc()}}var j,R,P,A,F,z,U,X,V,W=function(){return{fieldValue:"datasetId",fieldName:"datasetName"}},_=((j=function(){function e(t,c,i,a,l){var o=this;n(this,e),this.layerService=t,this.datasetService=c,this.toast=i,this.router=a,this.route=l,this.UserStatusEnum=u.b,this.ColumnMode=s.a,this.lstBulk=[{name:"delete",title:"X\xf3a"}],this.actions=[{name:"view",tooltip:"Xem l\u1edbp GDB",click:function(e){o.router.navigate(["detail",e.layerId],{relativeTo:o.route})}},{name:"delete"}],this.datatableService={service:this.layerService,primaryField:"layerId",builder:this.getBuilder.bind(this)},this.lstDataset=[],this.lstDatasetIdSelected=[],this.isDlgFromGDB=!1,this.dlgThemMoiLayer=!1}return i(e,[{key:"ngOnInit",value:function(){var e=this;this.datasetService.getMany().subscribe((function(t){return e.lstDataset=t}))}},{key:"viewFieldRequest",value:function(e){}},{key:"getBuilder",value:function(e){e.select(["layerName","url","stt"]),e.setFilter({field:"datasetId",operator:"$in",value:this.lstDatasetIdSelected})}},{key:"update",value:function(e){var t=this;this.layerService.patch(e.layerId,{layerName:e.layerName,url:e.url,isApi:e.isApi,stt:e.stt}).subscribe((function(){t.toast.success("C\u1eadp nh\u1eadt th\xe0nh c\xf4ng","Th\xe0nh c\xf4ng")}),(function(e){return t.toast.success(e,"L\u1ed7i")}))}}]),e}()).\u0275fac=function(e){return new(e||j)(h.Xb(r.a),h.Xb(d.a),h.Xb(f.qb),h.Xb(b.c),h.Xb(b.a))},j.\u0275cmp=h.Rb({type:j,selectors:[["ga-layer"]],viewQuery:function(e,t){var n;1&e&&(h.Sc(S,!0),h.Jc(O,!0),h.Jc(L,!0)),2&e&&(h.zc(n=h.lc())&&(t.table=n.first),h.zc(n=h.lc())&&(t.cellTplLayerName=n.first),h.zc(n=h.lc())&&(t.celxTplLayerName=n.first))},decls:26,vars:17,consts:[[1,"d-flex","justify-content-between"],["size","small","nbButton","","ghost","","nbTooltip","T\u1ea3i l\u1ea1i",3,"click"],["icon","refresh"],["nbButton","","size","small","status","primary","ghost","","nbTooltip","N\u1ea1p d\u1eef li\u1ec7u t\u1eeb GDB",3,"click"],["icon","arrow-circle-down"],["size","small","nbButton","","outline","","nbTooltip","Th\xeam m\u1edbi","status","primary",3,"click"],["icon","plus"],["fullWidth","","placeholder","Ch\u1ecdn dataset",3,"lstValue","multiple","value","config","valueChange"],["selectionType","checkbox",1,"material","striped","mt-2",3,"externalPaging","limit","datatableService","actions","bulkActions","scrollbarH"],["table",""],["name","M\xe3","prop","layerId",3,"width"],["name","T\xean","prop","layerName",3,"width"],["ngn-datatable-cell-template",""],["name","STT","prop","stt",3,"width"],["name","\u0110\u01b0\u1eddng d\u1eabn","prop","url",3,"width"],[3,"close",4,"ngIf"],["nbInput","","fieldSize","small","fullWidth","",3,"ngModel","ngModelChange","change"],[3,"close"]],template:function(e,t){if(1&e){var n=h.ec();h.dc(0,"nb-card"),h.dc(1,"nb-card-header",0),h.dc(2,"span"),h.Oc(3,"L\u1edbp d\u1eef li\u1ec7u"),h.cc(),h.dc(4,"div"),h.dc(5,"button",1),h.kc("click",(function(){return h.Dc(n),h.Ac(15).loadData()})),h.Yb(6,"nb-icon",2),h.cc(),h.dc(7,"button",3),h.kc("click",(function(){return t.isDlgFromGDB=!0})),h.Yb(8,"nb-icon",4),h.cc(),h.dc(9,"button",5),h.kc("click",(function(){return t.dlgThemMoiLayer=!0})),h.Yb(10,"nb-icon",6),h.Oc(11," Th\xeam m\u1edbi "),h.cc(),h.cc(),h.cc(),h.dc(12,"nb-card-body"),h.dc(13,"ga-select",7),h.kc("valueChange",(function(e){return t.lstDatasetIdSelected=e}))("valueChange",(function(){return h.Dc(n),h.Ac(15).loadData()})),h.cc(),h.dc(14,"ngn-datatable",8,9),h.Yb(16,"ngn-datatable-column",10),h.dc(17,"ngn-datatable-column",11),h.Mc(18,M,1,1,"ng-template",12),h.cc(),h.dc(19,"ngn-datatable-column",13),h.Mc(20,B,1,1,"ng-template",12),h.cc(),h.dc(21,"ngn-datatable-column",14),h.Mc(22,x,1,1,"ng-template",12),h.cc(),h.cc(),h.cc(),h.cc(),h.Mc(23,N,1,0,"app-them-moi-layer",15),h.Mc(24,G,1,0,"app-from-gdb",15),h.Yb(25,"router-outlet")}2&e&&(h.Lb(13),h.sc("lstValue",t.lstDataset)("multiple",!0)("value",t.lstDatasetIdSelected)("config",h.uc(16,W)),h.Lb(1),h.sc("externalPaging",!0)("limit",10)("datatableService",t.datatableService)("actions",t.actions)("bulkActions",t.lstBulk)("scrollbarH",!0),h.Lb(2),h.sc("width",150),h.Lb(1),h.sc("width",250),h.Lb(2),h.sc("width",100),h.Lb(2),h.sc("width",600),h.Lb(2),h.sc("ngIf",t.dlgThemMoiLayer),h.Lb(1),h.sc("ngIf",t.isDlgFromGDB))},directives:[f.r,f.t,f.o,f.rb,f.D,f.q,p.a,s.d,s.c,s.b,o.u,b.h,f.G,g.b,g.j,g.m,v,I],styles:[""]}),j),q=a("BDdu"),Y=a("1ua0"),E=((R=function e(){n(this,e)}).\u0275mod=h.Vb({type:R}),R.\u0275inj=h.Ub({factory:function(e){return new(e||R)},imports:[[o.c,Y.a,f.p,s.e]]}),R),H=a("jF+W"),J=["dlgViewField"],Q=((P=function(){function e(t,c,i){n(this,e),this.router=t,this.activatedRoute=c,this.layerService=i,this.userConfig={closeOnBackdropClick:!1},this.columnsViewField=[]}return i(e,[{key:"ngOnInit",value:function(){var e=this;this.columnsViewField=[{name:"M\xe3 c\u1ed9t",prop:"name"},{name:"T\xean c\u1ed9t",prop:"alias"},{name:"Ki\u1ec3u d\u1eef li\u1ec7u",prop:"type"},{name:"R\u1ed7ng",prop:"isNullable"},{name:"Domain",prop:"domainId"}],this.activatedRoute.paramMap.subscribe((function(t){var n=t.get("layerId");e.layerService.getOne(n,{fields:["layerId","layerName"],join:{field:"fields"}}).subscribe((function(t){e.viewField=t}))}))}},{key:"closeViewField",value:function(){this.router.navigate(["../.."],{relativeTo:this.activatedRoute})}},{key:"ngOnDestroy",value:function(){this.dlgViewField.close()}}]),e}()).\u0275fac=function(e){return new(e||P)(h.Xb(b.c),h.Xb(b.a),h.Xb(r.a))},P.\u0275cmp=h.Rb({type:P,selectors:[["ga-field"]],viewQuery:function(e,t){var n;1&e&&h.Jc(J,!0),2&e&&h.zc(n=h.lc())&&(t.dlgViewField=n.first)},decls:9,vars:9,consts:[[3,"open","userConfig"],["dlgViewField",""],[1,"body"],[1,"material","striped","mt-2",3,"externalPaging","columns","rows","scrollbarH"],["nbButton","","size","small","ghost","",3,"click"]],template:function(e,t){1&e&&(h.dc(0,"core-dialog",0,1),h.dc(2,"core-dialog-header"),h.Oc(3),h.cc(),h.dc(4,"core-dialog-body",2),h.Yb(5,"ngn-datatable",3),h.cc(),h.dc(6,"core-dialog-footer"),h.dc(7,"button",4),h.kc("click",(function(){return t.closeViewField()})),h.Oc(8,"\u0110\xf3ng"),h.cc(),h.cc(),h.cc()),2&e&&(h.sc("open",!0)("userConfig",t.userConfig),h.Lb(3),h.Qc("Thu\u1ed9c t\xednh c\u1ee7a l\u1edbp d\u1eef li\u1ec7u ",null==t.viewField?null:t.viewField.layerName,""),h.Lb(1),h.Kc("min-height",120,"px"),h.Lb(1),h.sc("externalPaging",!0)("columns",t.columnsViewField)("rows",null==t.viewField?null:t.viewField.fields)("scrollbarH",!0))},directives:[H.b,H.d,H.a,s.d,H.c,f.o],styles:[".body[_ngcontent-%COMP%]{min-height:-webkit-fit-content;min-height:-moz-fit-content;min-height:fit-content;max-height:560px;width:560px}"]}),P),K=a("DS98"),$=((F=function e(){n(this,e)}).\u0275mod=h.Vb({type:F}),F.\u0275inj=h.Ub({factory:function(e){return new(e||F)},imports:[[o.c,f.H,f.p,y.g,g.p,f.k,y.b,f.lb,f.w]]}),F),Z=((A=function e(){n(this,e)}).\u0275mod=h.Vb({type:A}),A.\u0275inj=h.Ub({factory:function(e){return new(e||A)},imports:[[o.c,s.e,K.a,f.u,f.p,f.F,y.g,f.sb]]}),A),ee=a("xMsH"),te=((V=function e(){n(this,e)}).\u0275mod=h.Vb({type:V}),V.\u0275inj=h.Ub({factory:function(e){return new(e||V)},imports:[[o.c,f.gb]]}),V),ne=((X=function e(){n(this,e)}).\u0275mod=h.Vb({type:X}),X.\u0275inj=h.Ub({factory:function(e){return new(e||X)},imports:[[o.c,g.g,y.b,y.g,f.H,y.i,f.p,te,f.lb,f.w]]}),X),ce=((U=function e(){n(this,e)}).\u0275mod=h.Vb({type:U}),U.\u0275inj=h.Ub({factory:function(e){return new(e||U)},imports:[[o.c,f.u,g.g,f.H,f.F,f.w,s.e,f.p,f.sb,ne,f.gb,y.b,te,y.i]]}),U),ie=((z=function e(){n(this,e)}).\u0275mod=h.Vb({type:z}),z.\u0275inj=h.Ub({factory:function(e){return new(e||z)},imports:[[o.c,f.u,f.H,y.i,f.p,g.g,f.lb,ee.c,f.Y,y.g,f.F,f.f,b.g,f.F,f.sb,ce,f.w,ne,y.b]]}),z),ae=a("4k3B");function le(e,t){if(1&e&&(h.dc(0,"nb-option",2),h.Oc(1),h.cc()),2&e){var n=t.$implicit;h.sc("value",n),h.Lb(1),h.Qc(" ",n," ")}}var oe,re,se=((re=function(){function e(t){n(this,e),this.layerTableService=t,this.valueChange=new h.r}return i(e,[{key:"ngOnInit",value:function(){var e=this;this.layerTableService.getColumnType().subscribe((function(t){return e.columnTypes=t}))}}]),e}()).\u0275fac=function(e){return new(e||re)(h.Xb(r.a))},re.\u0275cmp=h.Rb({type:re,selectors:[["app-table-column-type"]],inputs:{value:"value"},outputs:{valueChange:"valueChange"},decls:2,vars:2,consts:[["fullWidth","","placeholder","",3,"selected","selectedChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(e,t){1&e&&(h.dc(0,"nb-select",0),h.kc("selectedChange",(function(e){return t.valueChange.emit(e)})),h.Mc(1,le,2,2,"nb-option",1),h.cc()),2&e&&(h.sc("selected",t.value),h.Lb(1),h.sc("ngForOf",t.columnTypes))},directives:[f.fb,o.t,f.W],styles:[""]}),re),ue=((oe=function(){function e(t){n(this,e),this.toast=t,this.close=new h.r,this.entityAdd={nullable:!0},this.status={adding:!1},this.autoFill=!1}return i(e,[{key:"ngOnInit",value:function(){}},{key:"themMoi",value:function(){try{this.checkValid()&&this.close.emit(this.entityAdd)}catch(e){this.toast.danger(e.message,"L\u1ed7i")}}},{key:"checkValid",value:function(){if(!this.entityAdd.name)throw new Error("Vui l\xf2ng nh\u1eadp t\xean thu\u1ed9c t\xednh");if(!this.entityAdd.type)throw new Error("Vui l\xf2ng nh\u1eadp ki\u1ec3u d\u1eef li\u1ec7u");return!0}}]),e}()).\u0275fac=function(e){return new(e||oe)(h.Xb(f.qb))},oe.\u0275cmp=h.Rb({type:oe,selectors:[["ga-them-moi"]],inputs:{entityAdd:"entityAdd"},outputs:{close:"close"},decls:20,vars:12,consts:[[3,"open"],[1,"mb-3"],["nbInput","","dnInput","","placeholder","T\xean thu\u1ed9c t\xednh",3,"label","fullWidth","ngModel","ngModelChange"],["nbInput","","dnInput","","placeholder","M\xf4 t\u1ea3",3,"label","fullWidth","ngModel","ngModelChange"],[3,"value","valueChange"],[3,"disabled","checked","checkedChange"],[1,"d-flex","justify-content-end"],["nbButton","","size","small","ghost","",3,"click"],["nbButton","","size","small","type","submit","status","primary",3,"disabled","nbSpinner","click"]],template:function(e,t){1&e&&(h.dc(0,"dn-dialog",0),h.dc(1,"dn-dialog-header"),h.Oc(2,"Th\xeam m\u1edbi thu\u1ed9c t\xednh"),h.cc(),h.dc(3,"dn-dialog-body"),h.dc(4,"div",1),h.dc(5,"input",2),h.kc("ngModelChange",(function(e){return t.entityAdd.name=e})),h.cc(),h.cc(),h.dc(6,"div",1),h.dc(7,"input",3),h.kc("ngModelChange",(function(e){return t.entityAdd.alias=e})),h.cc(),h.cc(),h.dc(8,"div",1),h.dc(9,"label"),h.Oc(10,"Ki\u1ec3u d\u1eef li\u1ec7u"),h.cc(),h.dc(11,"app-table-column-type",4),h.kc("valueChange",(function(e){return t.entityAdd.type=e})),h.cc(),h.cc(),h.dc(12,"div"),h.dc(13,"nb-checkbox",5),h.kc("checkedChange",(function(e){return t.entityAdd.ai=e})),h.Oc(14,"T\u1ef1 \u0111\u1ed9ng t\u0103ng"),h.cc(),h.cc(),h.cc(),h.dc(15,"dn-dialog-footer",6),h.dc(16,"button",7),h.kc("click",(function(){return t.close.emit()})),h.Oc(17,"\u0110\xf3ng"),h.cc(),h.dc(18,"button",8),h.kc("click",(function(){return t.themMoi()})),h.Oc(19," Th\xeam m\u1edbi "),h.cc(),h.cc(),h.cc()),2&e&&(h.sc("open",!0),h.Lb(5),h.sc("label",!0)("fullWidth",!0)("ngModel",t.entityAdd.name),h.Lb(2),h.sc("label",!0)("fullWidth",!0)("ngModel",t.entityAdd.alias),h.Lb(4),h.sc("value",t.entityAdd.type),h.Lb(2),h.sc("disabled",!("int"===t.entityAdd.type||"bigint"===t.entityAdd.type||"uniqueidentifier"===t.entityAdd.type))("checked",t.entityAdd.ai),h.Lb(5),h.sc("disabled",t.status.adding)("nbSpinner",t.status.adding))},directives:[y.d,y.f,y.c,f.G,y.h,g.b,g.j,g.m,se,f.v,y.e,f.o,f.kb],styles:[""]}),oe),de=["table"];function he(e,t){if(1&e){var n=h.ec();h.dc(0,"input",23),h.kc("ngModelChange",(function(e){return h.Dc(n),t.row.alias=e}))("ngModelChange",(function(){return t.row.isChange=!0})),h.cc()}if(2&e){var c=t.row;h.sc("fullWidth",!0)("ngModel",c.alias)}}function fe(e,t){if(1&e&&(h.dc(0,"nb-option",21),h.Oc(1),h.cc()),2&e){var n=t.$implicit;h.sc("value",n),h.Lb(1),h.Pc(n)}}function be(e,t){if(1&e){var n=h.ec();h.dc(0,"nb-select",24),h.kc("selectedChange",(function(e){return h.Dc(n),t.row.type=e}))("selectedChange",(function(){return t.row.isChange=!0})),h.Mc(1,fe,2,2,"nb-option",19),h.cc()}if(2&e){var c=t.row,i=h.mc();h.sc("selected",c.type),h.Lb(1),h.sc("ngForOf",i.columnTypes)}}function pe(e,t){if(1&e){var n=h.ec();h.dc(0,"nb-checkbox",25),h.kc("checkedChange",(function(e){h.Dc(n);var c=t.row;return c.isNullable=!e,c.isChange=!0})),h.cc()}2&e&&h.sc("checked",!t.row.isNullable)}function ge(e,t){if(1&e){var n=h.ec();h.dc(0,"dn-auto-complete",26),h.kc("valueChange",(function(e){return h.Dc(n),t.row.joinTable=e})),h.cc()}if(2&e){var c=t.row,i=h.mc();h.sc("service",i.layerService)("value",c.joinTable)}}function me(e,t){if(1&e&&(h.dc(0,"nb-option",21),h.Oc(1),h.cc()),2&e){var n=t.$implicit;h.sc("value",n.name),h.Lb(1),h.Pc(n.name)}}function ye(e,t){if(1&e){var n=h.ec();h.dc(0,"ga-them-moi",27),h.kc("close",(function(e){return h.Dc(n),h.mc().closeDlgThemMoi(e)})),h.cc()}}function ve(e,t){if(1&e){var n=h.ec();h.dc(0,"ga-xoa-bo",27),h.kc("close",(function(){return h.Dc(n),h.mc().dlgXoa=!1})),h.cc()}}var ke,we=((ke=function(){function t(e,c){n(this,t),this.toast=e,this.layerService=c,this.layer={},this.selectionType=s.f.single,this.GeometryTypeEnum=ae.b,this.dlgThemMoi=!1,this.dlgXoa=!1,this.status={saving:!0,edit:!0,delete:!0},this.rows=[],this.selectedRows=[],this.rowsDelete=[]}return i(t,[{key:"ngOnInit",value:function(){var e=this;this.loadRows(),this.layerService.getColumnType().subscribe((function(t){return e.columnTypes=t}))}},{key:"loadRows",value:function(){var e=this;this.layerService.getColumns({table:this.layerId}).subscribe((function(t){e.rows=t.filter((function(e){return"geometry"!==e.type}))}))}},{key:"phucHoi",value:function(){this.loadRows()}},{key:"save",value:function(){return Object(m.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=this.rows.filter((function(e){return!e.isDelete})),e.next=4,this.layerService.syncColumn({tableName:this.layerId,columns:t}).toPromise();case 4:this.layerService.updateDisplayColumn({tableName:this.layerId,columnDisplay:this.displayColumn.name}).subscribe({next:function(){},error:function(){n.toast.danger("C\xf3 l\u1ed7i x\u1ea3y ra khi c\u1eadp nh\u1eadt c\u1ed9t \u0111\u1ea1i di\u1ec7n","Th\xf4ng b\xe1o")}}),this.geometryType!==this.layer.geometryType&&this.layerService.changeGeometryType({tableName:this.layerId,geometryType:this.layer.geometryType}).subscribe({next:function(e){n.toast.success(e.message,"Th\xf4ng b\xe1o c\u1eadp nh\u1eadt ki\u1ec3u d\u1eef li\u1ec7u kh\xf4ng gian",{duration:5e3}),n.geometryType=n.layer.geometryType},error:function(){n.toast.danger("C\xf3 l\u1ed7i x\u1ea3y ra khi thay \u0111\u1ed5i ki\u1ec3u d\u1eef li\u1ec7u kh\xf4ng gian","Th\xf4ng b\xe1o")}}),this.loadRows(),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),this.toast.danger(e.t0.message,"L\u1ed7i");case 12:case"end":return e.stop()}}),e,this,[[0,9]])})))}},{key:"closeDlgThemMoi",value:function(t){if(t){if(this.rows.some((function(e){return e.name===t.name})))return this.toast.danger("\u0110\xe3 t\u1ed3n t\u1ea1i c\u1ed9t "+t.name,"L\u1ed7i");this.rows=[].concat(e(this.rows),[Object.assign(Object.assign({},t),{isNew:!0})])}this.dlgThemMoi=!1}},{key:"getRowClass",value:function(e){var t=e.isNew,n=e.isChange,c=e.isDelete,i=e.isPrimary;return{"is-new-row":Boolean(t),"is-change-row":Boolean(n),"is-delete-row":Boolean(c),"is-primary-row":Boolean(i)}}},{key:"removeColumns",value:function(){if(this.selectedRows.length>0){var t=e(this.rows);this.selectedRows.forEach((function(e){if(e.isNew){var n=t.findIndex((function(t){return t.name===e.name}));n>-1&&t.splice(n,1)}e.isDelete=!0})),this.rows=t,this.selectedRows=[]}}},{key:"changeDisplayColumn",value:function(e){this.rows.forEach((function(t){t.isDisplay=t.name===e}))}},{key:"changeGeometryType",value:function(e){!this.layer.geometryType&&e?this.toast.info("L\u1edbp d\u1eef li\u1ec7u \u0111\u01b0\u1ee3c chuy\u1ec3n \u0111\u1ed5i sang d\u1eef li\u1ec7u kh\xf4ng gian","C\u1ea3nh b\xe1o"):this.layer.geometryType!==e&&this.toast.info("L\u1edbp d\u1eef li\u1ec7u s\u1ebd \u0111\u01b0\u1ee3c chuy\u1ec3n \u0111\u1ed5i ki\u1ec3u d\u1eef li\u1ec7u, d\u1eef li\u1ec7u thu\u1ed9c t\xednh kh\xf4ng gian s\u1ebd b\u1ecb x\xf3a","C\u1ea3nh b\xe1o"),this.layer.geometryType=e}},{key:"layerId",get:function(){return this._layerId},set:function(e){var t=this;e!==this._layerId&&(this._layerId=e,this.layerService.getOne(e,{fields:["geometryType"]}).subscribe((function(e){t.layer.geometryType=t.geometryType=e.geometryType})))}},{key:"isChange",get:function(){return this.rows.some((function(e){return e.isDelete||e.isChange||e.isNew}))}},{key:"displayColumn",get:function(){return this.rows.find((function(e){return e.isDisplay}))||this.primaryColumn}},{key:"primaryColumn",get:function(){return this.rows.find((function(e){return e.isPrimary}))}}]),t}()).\u0275fac=function(e){return new(e||ke)(h.Xb(f.qb),h.Xb(r.a))},ke.\u0275cmp=h.Rb({type:ke,selectors:[["app-layer-column"]],viewQuery:function(e,t){var n;1&e&&h.Sc(de,!0),2&e&&h.zc(n=h.lc())&&(t.table=n.first)},inputs:{layerId:"layerId"},decls:39,vars:23,consts:[[1,"table-layer-column"],[1,"d-flex","justify-content-between"],["size","small","nbButton","","ghost","","nbTooltip","X\xf3a","nbs","","status","danger",3,"disabled","click"],["icon","trash-outline"],["size","small","nbButton","","ghost","","nbTooltip","Ph\u1ee5c h\u1ed3i","status","basic",3,"disabled","click"],["icon","backspace-outline"],["size","small","nbButton","","ghost","","nbTooltip","Th\xeam m\u1edbi","status","primary",3,"click"],["icon","plus-outline"],["columnMode","force","selectionType","checkbox",1,"material",3,"rows","footerHeight","scrollbarH","rowClass","selected","selectedChange"],["table",""],["prop","name","name","T\xean","type","string",3,"width"],["prop","alias","name","M\xf4 t\u1ea3","type","string",3,"width"],["ngn-datatable-cell-template",""],["prop","type","name","Ki\u1ec3u d\u1eef li\u1ec7u","type","number",3,"width"],["prop","isNullable","name","Kh\xf4ng tr\u1ed1ng",3,"width"],["prop","joinTable","name","Quan h\u1ec7",3,"width"],[1,"row"],[1,"col-md-6","col-lg-4","col-xs-12"],["size","tiny","fullWidth","","placeholder","Thu\u1ed9c t\xednh \u0111\u1ea1i di\u1ec7n","dnInput","",3,"label","selected","selectedChange"],[3,"value",4,"ngFor","ngForOf"],["size","tiny","fullWidth","","placeholder","Lo\u1ea1i kh\xf4ng gian","dnInput","",3,"label","selected","selectedChange"],[3,"value"],[3,"close",4,"ngIf"],["nbInput","","placeholder","M\xf4 t\u1ea3","fieldSize","tiny",3,"fullWidth","ngModel","ngModelChange"],["size","tiny","fullWidth","",3,"selected","selectedChange"],["size","tiny",3,"checked","checkedChange"],["fieldName","layerName","fieldValue","layerId","fieldSize","tiny",3,"service","value","valueChange"],[3,"close"]],template:function(e,t){1&e&&(h.dc(0,"nb-card",0),h.dc(1,"nb-card-header",1),h.dc(2,"span"),h.Oc(3,"Qu\u1ea3n l\xfd thu\u1ed9c t\xednh"),h.cc(),h.dc(4,"div"),h.dc(5,"button",2),h.kc("click",(function(){return t.removeColumns()})),h.Yb(6,"nb-icon",3),h.cc(),h.dc(7,"button",4),h.kc("click",(function(){return t.phucHoi()})),h.Yb(8,"nb-icon",5),h.cc(),h.dc(9,"button",6),h.kc("click",(function(){return t.dlgThemMoi=!0})),h.Yb(10,"nb-icon",7),h.cc(),h.cc(),h.cc(),h.dc(11,"nb-card-body"),h.dc(12,"ngn-datatable",8,9),h.kc("selectedChange",(function(e){return t.selectedRows=e})),h.Yb(14,"ngn-datatable-column",10),h.dc(15,"ngn-datatable-column",11),h.Mc(16,he,1,2,"ng-template",12),h.cc(),h.dc(17,"ngn-datatable-column",13),h.Mc(18,be,2,2,"ng-template",12),h.cc(),h.dc(19,"ngn-datatable-column",14),h.Mc(20,pe,1,1,"ng-template",12),h.cc(),h.dc(21,"ngn-datatable-column",15),h.Mc(22,ge,1,2,"ng-template",12),h.cc(),h.cc(),h.dc(23,"div",16),h.dc(24,"div",17),h.dc(25,"nb-select",18),h.kc("selectedChange",(function(e){return t.changeDisplayColumn(e)})),h.Mc(26,me,2,2,"nb-option",19),h.cc(),h.cc(),h.dc(27,"div",17),h.dc(28,"nb-select",20),h.kc("selectedChange",(function(e){return t.changeGeometryType(e)})),h.dc(29,"nb-option",21),h.Oc(30,"Kh\xf4ng ph\u1ea3i l\u1edbp kh\xf4ng gian"),h.cc(),h.dc(31,"nb-option",21),h.Oc(32,"\u0110i\u1ec3m"),h.cc(),h.dc(33,"nb-option",21),h.Oc(34,"\u0110\u01b0\u1eddng"),h.cc(),h.dc(35,"nb-option",21),h.Oc(36,"V\xf9ng"),h.cc(),h.cc(),h.cc(),h.cc(),h.cc(),h.cc(),h.Mc(37,ye,1,0,"ga-them-moi",22),h.Mc(38,ve,1,0,"ga-xoa-bo",22)),2&e&&(h.Lb(5),h.sc("disabled",!t.selectedRows.length),h.Lb(2),h.sc("disabled",!t.isChange),h.Lb(5),h.sc("rows",t.rows)("footerHeight",50)("scrollbarH",!0)("rowClass",t.getRowClass)("selected",t.selectedRows),h.Lb(2),h.sc("width",200),h.Lb(1),h.sc("width",250),h.Lb(2),h.sc("width",120),h.Lb(2),h.sc("width",50),h.Lb(2),h.sc("width",150),h.Lb(4),h.sc("label",!0)("selected",null==t.displayColumn?null:t.displayColumn.name),h.Lb(1),h.sc("ngForOf",t.rows),h.Lb(2),h.sc("label",!0)("selected",t.geometryType),h.Lb(1),h.sc("value",null),h.Lb(2),h.sc("value",t.GeometryTypeEnum.Point),h.Lb(2),h.sc("value",t.GeometryTypeEnum.Polyline),h.Lb(2),h.sc("value",t.GeometryTypeEnum.Polygon),h.Lb(2),h.sc("ngIf",t.dlgThemMoi),h.Lb(1),h.sc("ngIf",t.dlgXoa))},directives:[f.r,f.t,f.o,f.rb,f.D,f.q,s.d,s.c,s.b,f.fb,y.h,o.t,f.W,o.u,f.G,g.b,g.j,g.m,f.v,y.a,ue],styles:[".table-layer-column[_ngcontent-%COMP%]     .ngn-datatable .is-primary-row{border:1px solid #ffdd59}.table-layer-column[_ngcontent-%COMP%]     .ngn-datatable .is-new-row{background-color:#55efc4}.table-layer-column[_ngcontent-%COMP%]     .ngn-datatable .is-change-row{background-color:#fd79a8}.table-layer-column[_ngcontent-%COMP%]     .ngn-datatable .is-delete-row{background-color:#ff7675}"]}),ke);function Ce(e,t){if(1&e){var n=h.ec();h.dc(0,"button",26),h.kc("click",(function(){return h.Dc(n),h.mc(2).exampleRendererSimple({type:"point"})})),h.Oc(1," Point "),h.cc(),h.dc(2,"button",26),h.kc("click",(function(){return h.Dc(n),h.mc(2).exampleRendererSimple({type:"polyline"})})),h.Oc(3," Polyline "),h.cc(),h.dc(4,"button",26),h.kc("click",(function(){return h.Dc(n),h.mc(2).exampleRendererSimple({type:"polygon"})})),h.Oc(5," Polygon "),h.cc()}}function Te(e,t){if(1&e){var n=h.ec();h.dc(0,"button",26),h.kc("click",(function(){return h.Dc(n),h.mc(2).exampleRendererUnique({type:"point"})})),h.Oc(1," Point "),h.cc(),h.dc(2,"button",26),h.kc("click",(function(){return h.Dc(n),h.mc(2).exampleRendererUnique({type:"polyline"})})),h.Oc(3," Polyline "),h.cc(),h.dc(4,"button",26),h.kc("click",(function(){return h.Dc(n),h.mc(2).exampleRendererUnique({type:"polygon"})})),h.Oc(5," Polygon "),h.cc()}}function De(e,t){if(1&e&&(h.dc(0,"nb-accordion-item"),h.dc(1,"nb-accordion-item-header"),h.Oc(2,"Thu\u1ed9c t\xednh"),h.cc(),h.dc(3,"nb-accordion-item-body"),h.Yb(4,"app-layer-column",27),h.cc(),h.cc()),2&e){var n=h.mc(2);h.Lb(4),h.sc("layerId",n.layerId)}}function Ie(e,t){if(1&e){var n=h.ec();h.dc(0,"button",28),h.kc("click",(function(){return h.Dc(n),h.mc(2).dlgCreateTable=!0})),h.Yb(1,"nb-icon",25),h.Oc(2," T\u1ea1o b\u1ea3ng "),h.cc()}if(2&e){var c=h.mc(2);h.sc("nbSpinner",c.status.isCraeteTable)("disabled",c.status.isCraeteTable)}}var Se=function(){return["../.."]};function Oe(e,t){if(1&e){var n=h.ec();h.dc(0,"dn-dialog",2),h.dc(1,"dn-dialog-header",3),h.dc(2,"span"),h.Oc(3," Th\xf4ng tin l\u1edbp d\u1eef li\u1ec7u "),h.cc(),h.dc(4,"div"),h.dc(5,"button",4),h.Yb(6,"nb-icon",5),h.cc(),h.cc(),h.cc(),h.dc(7,"dn-dialog-body"),h.dc(8,"nb-accordion"),h.dc(9,"nb-accordion-item"),h.dc(10,"nb-accordion-item-header"),h.Oc(11,"Th\xf4ng tin l\u1edbp d\u1eef li\u1ec7u"),h.cc(),h.dc(12,"nb-accordion-item-body"),h.dc(13,"div",6),h.dc(14,"div",7),h.dc(15,"input",8),h.kc("ngModelChange",(function(e){return h.Dc(n),h.mc().value.layerId=e})),h.cc(),h.cc(),h.dc(16,"div",7),h.dc(17,"input",9),h.kc("ngModelChange",(function(e){return h.Dc(n),h.mc().value.layerName=e})),h.cc(),h.cc(),h.dc(18,"div",7),h.dc(19,"dn-auto-complete",10),h.kc("valueChange",(function(e){return h.Dc(n),h.mc().value.datasetId=e})),h.cc(),h.cc(),h.dc(20,"div",11),h.dc(21,"div",12),h.dc(22,"input",13),h.kc("ngModelChange",(function(e){return h.Dc(n),h.mc().value.url=e})),h.cc(),h.dc(23,"nb-checkbox",14),h.kc("checkedChange",(function(e){return h.Dc(n),h.mc().value.isApi=e})),h.Oc(24,"API"),h.cc(),h.cc(),h.cc(),h.cc(),h.cc(),h.cc(),h.dc(25,"nb-accordion-item"),h.dc(26,"nb-accordion-item-header"),h.Oc(27,"C\u1ea5u h\xecnh l\u1edbp d\u1eef li\u1ec7u"),h.cc(),h.dc(28,"nb-accordion-item-body"),h.dc(29,"button",15),h.kc("click",(function(){return h.Dc(n),h.mc().example()})),h.Oc(30,"Tham kh\u1ea3o"),h.cc(),h.dc(31,"button",16),h.Oc(32," Renderer Simple "),h.Mc(33,Ce,6,0,"ng-template",null,17,h.Nc),h.cc(),h.dc(35,"button",16),h.Oc(36," Renderer Unique "),h.Mc(37,Te,6,0,"ng-template",null,18,h.Nc),h.cc(),h.dc(39,"json-editor",19,20),h.kc("ngModelChange",(function(e){return h.Dc(n),h.mc().value.config=e})),h.cc(),h.cc(),h.cc(),h.Mc(41,De,5,1,"nb-accordion-item",21),h.cc(),h.cc(),h.dc(42,"dn-dialog-footer",22),h.Mc(43,Ie,3,2,"button",23),h.dc(44,"button",24),h.kc("click",(function(){return h.Dc(n),h.mc().save()})),h.Yb(45,"nb-icon",25),h.Oc(46," L\u01b0u "),h.cc(),h.cc(),h.cc()}if(2&e){var c=h.Ac(34),i=h.Ac(38),a=h.mc();h.sc("open",!0),h.Lb(5),h.sc("routerLink",h.uc(19,Se)),h.Lb(10),h.sc("label",!0)("ngModel",a.value.layerId),h.Lb(2),h.sc("label",!0)("ngModel",a.value.layerName),h.Lb(2),h.sc("service",a.datasetService)("value",a.value.datasetId)("fullWidth",!0),h.Lb(3),h.sc("ngModel",a.value.url),h.Lb(1),h.sc("checked",a.value.isApi),h.Lb(8),h.sc("nbPopover",c),h.Lb(4),h.sc("nbPopover",i),h.Lb(4),h.sc("options",a.editorOptions)("ngModel",a.value.config),h.Lb(2),h.sc("ngIf",a.hasTable),h.Lb(2),h.sc("ngIf",!a.hasTable),h.Lb(1),h.sc("nbSpinner",a.status.isSaving)("disabled",a.status.isSaving)}}var Le=function(){return{name:"OBJECTID",type:"int",alias:"ObjectId"}};function Me(e,t){if(1&e){var n=h.ec();h.dc(0,"ga-them-moi",29),h.kc("close",(function(e){h.Dc(n);var t=h.mc();return e&&t.createTable(e)})),h.cc()}2&e&&h.sc("entityAdd",h.uc(1,Le))}var Be,xe,Ne=((xe=function(){function e(t,c,i,a){n(this,e),this.route=t,this.layerService=c,this.toast=i,this.datasetService=a,this.legends=[],this.editorOptions=new ee.b,this.hasTable=!1,this.dlgCreateTable=!1,this.status={isSaving:!1,isCreateTable:!1}}return i(e,[{key:"ngOnInit",value:function(){var e=this;if(this.editorOptions.mode="code",this.editorOptions.modes=["code","tree"],this.layerId=this.route.snapshot.paramMap.get("id"),!this.layerId)throw new Error("Kh\xf4ng x\xe1c nh\u1eadn \u0111\u01b0\u1ee3c param layerId");this.loadData(this.layerId),this.layerService.hasTable({table:this.layerId}).subscribe((function(t){e.hasTable=t.has}))}},{key:"loadData",value:function(e){var t=this;this.layerService.getOne(e,{fields:["layerId","layerName","config","url","isApi","datasetId"]}).subscribe((function(e){t.value=e}))}},{key:"save",value:function(){return Object(m.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.status.isSaving=!0,e.next=4,this.layerService.patch(this.value.layerId,this.value).toPromise();case 4:return e.next=6,this.layerColumnRef.save();case 6:this.toast.success("L\u01b0u th\xe0nh c\xf4ng","Th\xf4ng b\xe1o"),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),this.toast.danger(e.t0.message,"L\u1ed7i");case 12:return e.prev=12,this.status.isSaving=!1,e.finish(12);case 15:case"end":return e.stop()}}),e,this,[[0,9,12,15]])})))}},{key:"example",value:function(){this.value.config={minZoom:null,maxZoom:null,renderer:{type:"",symbol:{}}}}},{key:"exampleRendererSimple",value:function(e){var t=this.getSymbol(e.type);this.value.config=Object.assign(Object.assign({},this.value.config),{renderer:{type:"simple",symbol:t}})}},{key:"exampleRendererUnique",value:function(e){var t=e.type;this.value.config||(this.value.config={});var n=this.getSymbol(t);this.value.config=Object.assign(Object.assign({},this.value.config),{renderer:{type:"unique",field:"",defaultSymbol:n,values:[{value:null,symbol:n}]}})}},{key:"getSymbol",value:function(e){return"point"===e?{type:"picture-marker",url:"",width:20,height:20}:{type:"polygon"===e?"simple-fill":"simple-line",color:"#000",fill:!0,stroke:!0,fillColor:"#000",fillOpacity:1,opacity:1}}},{key:"close",value:function(){}},{key:"createTable",value:function(e){var t=this;!this.hasTable&&this.layerId&&e&&(this.toast.info("H\u1ec7 th\u1ed1ng \u0111ang ghi nh\u1eadn, vui l\xf2ng \u0111\u1ee3i!","Th\xf4ng b\xe1o"),this.status.isCreateTable=!0,this.layerService.createTable({table:{name:this.layerId,columns:[Object.assign(Object.assign({},e),{isPrimary:!0})]}}).pipe(Object(k.a)((function(){return t.status.isCreateTable=!1}))).subscribe({next:function(){t.toast.success("B\u1ea3ng \u0111\xe3 \u0111\u01b0\u1ee3c \u0111\u1ed3ng b\u1ed9 v\xe0o c\u01a1 s\u1edf d\u1eef li\u1ec7u"),t.hasTable=!0,t.dlgCreateTable=!1},error:function(e){t.toast.danger(e.message,"L\u1ed7i")}}))}}]),e}()).\u0275fac=function(e){return new(e||xe)(h.Xb(b.a),h.Xb(r.a),h.Xb(f.qb),h.Xb(d.a))},xe.\u0275cmp=h.Rb({type:xe,selectors:[["app-layer-config"]],viewQuery:function(e,t){var n;1&e&&h.Sc(we,!0),2&e&&h.zc(n=h.lc())&&(t.layerColumnRef=n.first)},decls:2,vars:2,consts:[["width","100vw",3,"open",4,"ngIf"],[3,"entityAdd","close",4,"ngIf"],["width","100vw",3,"open"],[1,"d-flex","justify-content-between","align-items-center"],["nbButton","","ghost","","status","danger","size","small","nbTooltip","\u0110\xf3ng",3,"routerLink"],["icon","close"],[1,"row"],[1,"col-xs-12","col-md-6","p-1"],["nbInput","","fieldSize","small","type","text","fullWidth","","placeholder","M\xe3","disabled","","dnInput","",3,"label","ngModel","ngModelChange"],["nbInput","","fieldSize","small","type","text","dnInput","","fullWidth","","id","layerName","placeholder","T\xean l\u1edbp",3,"label","ngModel","ngModelChange"],["fieldSize","small","fieldName","datasetName","fieldValue","datasetId",3,"service","value","fullWidth","valueChange"],[1,"col-md-12","p-1"],[1,"d-flex"],["nbInput","","fieldSize","small","placeholder","\u0110\u01b0\u1eddng d\u1eabn","fullWidth","",1,"flex-grow-1","pr-1",3,"ngModel","ngModelChange"],[1,"pl-1",3,"checked","checkedChange"],["nbButton","","size","small",3,"click"],["nbButton","","size","small",3,"nbPopover"],["popsimp",""],["popUni",""],[1,"editor",3,"options","ngModel","ngModelChange"],["editor",""],[4,"ngIf"],[1,"d-flex","justify-content-end"],["nbButton","","status","primary","size","small","outline","",3,"nbSpinner","disabled","click",4,"ngIf"],["nbButton","","status","primary","size","small",3,"nbSpinner","disabled","click"],["icon","save-outline"],["nbButton","","size","tiny",3,"click"],[3,"layerId"],["nbButton","","status","primary","size","small","outline","",3,"nbSpinner","disabled","click"],[3,"entityAdd","close"]],template:function(e,t){1&e&&(h.Mc(0,Oe,47,20,"dn-dialog",0),h.Mc(1,Me,1,2,"ga-them-moi",1)),2&e&&(h.sc("ngIf",t.value),h.Lb(1),h.sc("ngIf",t.dlgCreateTable))},directives:[o.u,y.d,y.f,f.o,f.rb,b.d,f.D,y.c,f.b,f.d,f.e,f.c,f.G,y.h,g.b,g.j,g.m,y.a,f.v,f.X,ee.a,y.e,f.kb,we,ue],styles:[".jsoneditor-mode-code{height:1000px}.legend-container[_ngcontent-%COMP%]{margin-left:30px}.legend-container[_ngcontent-%COMP%]   .legend-item[_ngcontent-%COMP%]{display:flex;align-items:center}.legend-container[_ngcontent-%COMP%]   .legend-item__icon[_ngcontent-%COMP%]{width:20px;height:20px}.legend-container[_ngcontent-%COMP%]   .legend-item__text[_ngcontent-%COMP%]{flex:1;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;font-size:12px}"]}),xe),Ge=((Be=function e(){n(this,e)}).\u0275mod=h.Vb({type:Be}),Be.\u0275inj=h.Ub({factory:function(e){return new(e||Be)},imports:[[o.c,f.u,f.p,f.H,f.lb,f.k,g.g,f.sb,f.sb,Y.a,q.a,s.e,E,K.a,f.F,$,Z,ie,y.g,b.g.forChild([{path:"",component:_,children:[{path:":layerId/field",component:Q},{path:"detail/:id",component:Ne}]},{path:"gdb",loadChildren:function(){return a.e(13).then(a.bind(null,"45ZY")).then((function(e){return e.LayerGdbModule}))}}])],b.g]}),Be)},bANk:function(e,t,c){"use strict";c.d(t,"a",(function(){return d}));var l=c("AytR"),r=c("WJ/N"),s=c("fXoL"),u=c("tk/3"),d=function(){var e=function(e){a(c,e);var t=o(c);function c(e){return n(this,c),t.call(this,{apiUrl:l.a.apiUrl,entity:"sys/layer"},e)}return i(c,[{key:"getManyGDB",value:function(e){return this.http.get(this.getBaseUrl()+"/gdb",{params:this.getParamsFromQuery(e)})}},{key:"getOneGDB",value:function(e){return this.http.get(this.getBaseUrl()+"/gdb/"+e)}},{key:"updateDatasetName",value:function(e,t){return this.http.post(this.getBaseUrl()+"/gdb/alias/"+e,{layerName:t})}},{key:"getFields",value:function(e){return this.http.get(this.getBaseUrl()+"/gdb/".concat(e,"/field"))}},{key:"updateField",value:function(e,t,n){return this.http.post(this.getBaseUrl()+"/gdb/".concat(e,"/field/").concat(t),n)}},{key:"updateAliasNameFromGDB",value:function(e){return this.http.patch(this.getBaseUrl()+"/aliasfromgdb",{lstLayerId:e},{headers:{"Content-Type":"application/json"}})}},{key:"getColumnType",value:function(){return this.http.get(this.getBaseUrl()+"/columndatatype")}},{key:"getColumns",value:function(e){return this.http.get("".concat(this.getBaseUrl(),"/column/").concat(e.table))}},{key:"hasTable",value:function(e){return this.http.get("".concat(this.getBaseUrl(),"/hastable/").concat(e.table))}},{key:"createTable",value:function(e){return this.http.post(this.getBaseUrl()+"/createtable",JSON.stringify(e.table),{headers:{"content-type":"application/json"}})}},{key:"addColumn",value:function(e){return this.http.post("".concat(this.getBaseUrl(),"/addcolumn/").concat(e.tableName),JSON.stringify(e.column),{headers:{"content-type":"application/json"}})}},{key:"dropColumn",value:function(e){return this.http.delete("".concat(this.getBaseUrl(),"/dropColumn/").concat(e.tableName,"/").concat(e.columnName))}},{key:"syncColumn",value:function(e){return this.http.patch("".concat(this.getBaseUrl(),"/synccolumn/").concat(e.tableName),JSON.stringify(e.columns),{headers:{"content-type":"application/json"}})}},{key:"updateDisplayColumn",value:function(e){return this.http.patch("".concat(this.getBaseUrl(),"/columnDisplay/").concat(e.tableName),JSON.stringify({columnDisplay:e.columnDisplay}),{headers:{"content-type":"application/json"}})}},{key:"changeGeometryType",value:function(e){return this.http.patch("".concat(this.getBaseUrl(),"/geometrytype/").concat(e.tableName),JSON.stringify({geometryType:e.geometryType}),{headers:{"content-type":"application/json"}})}}]),c}(r.a);return e.\u0275fac=function(t){return new(t||e)(s.hc(u.b))},e.\u0275prov=s.Tb({token:e,factory:e.\u0275fac,providedIn:"root"}),e}()}}])}();