(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{uIsd:function(e,t,c){"use strict";c.r(t),c.d(t,"DomainModule",(function(){return C}));var n=c("ofXK"),d=c("Vvdx"),i=c("nYR2"),o=c("fXoL"),a=c("aceb"),l=c("tyNb"),s=c("3Pt+"),r=c("ExIg");function u(e,t){if(1&e){const e=o.ec();o.dc(0,"input",8),o.kc("ngModelChange",(function(c){return o.Dc(e),t.row.name=c}))("change",(function(){o.Dc(e);const c=t.row;return o.mc().updateName(c)})),o.cc()}2&e&&o.sc("ngModel",t.row.name)}function h(e,t){if(1&e){const e=o.ec();o.dc(0,"input",19),o.kc("ngModelChange",(function(c){return o.Dc(e),t.row.code=c})),o.cc()}if(2&e){const e=t.row,c=o.mc(2);o.sc("ngModel",e.code)("type",c.getCodeType())}}function m(e,t){if(1&e){const e=o.ec();o.dc(0,"input",20),o.kc("ngModelChange",(function(c){return o.Dc(e),t.row.name=c})),o.cc()}2&e&&o.sc("ngModel",t.row.name)}function g(e,t){if(1&e){const e=o.ec();o.dc(0,"button",21),o.kc("click",(function(){o.Dc(e);const c=t.row;return o.mc(2).deleteCodeValue(c)})),o.Yb(1,"nb-icon",22),o.cc()}}function b(e,t){if(1&e){const e=o.ec();o.dc(0,"nb-card-body"),o.dc(1,"div",9),o.dc(2,"input",10),o.kc("ngModelChange",(function(t){return o.Dc(e),o.mc().entityCodedValueAdd.code=t})),o.cc(),o.dc(3,"input",11),o.kc("ngModelChange",(function(t){return o.Dc(e),o.mc().entityCodedValueAdd.name=t})),o.cc(),o.dc(4,"button",12),o.kc("click",(function(){return o.Dc(e),o.mc().addCodedValue()})),o.Yb(5,"nb-icon",13),o.cc(),o.cc(),o.dc(6,"ngn-datatable",14),o.dc(7,"ngn-datatable-column",15),o.Mc(8,h,1,2,"ng-template",16),o.cc(),o.dc(9,"ngn-datatable-column",17),o.Mc(10,m,1,1,"ng-template",6),o.cc(),o.dc(11,"ngn-datatable-column",18),o.Mc(12,g,2,0,"ng-template",6),o.cc(),o.cc(),o.cc()}if(2&e){const e=o.mc();o.Lb(2),o.sc("type",e.getCodeType())("ngModel",e.entityCodedValueAdd.code),o.Lb(1),o.sc("ngModel",e.entityCodedValueAdd.name),o.Lb(1),o.sc("nbSpinner",e.isAddCodedValue)("disabled",e.isAddCodedValue),o.Lb(2),o.sc("rows",e.codedValues),o.Lb(1),o.sc("flexGrow",1),o.Lb(2),o.sc("flexGrow",2),o.Lb(2),o.sc("width",20)}}const p=function(e){return[e]},f=function(){return[]};let w=(()=>{class e{constructor(e,t,c,n,d){this.service=e,this.toast=t,this.router=c,this.route=n,this.domainService=d,this.rows=[],this.tmpRows=[],this.codedValues=[],this.entityCodedValueAdd={},this.isAddCodedValue=!1,this.datatableSeriveDomain={service:this.domainService,primaryField:"id",builder:this.getBuilderDomain.bind(this)}}get fName(){return this._fName}set fName(e){const t={};e&&(t.fname=e),this.router.navigate([],{relativeTo:this.route,queryParams:t})}ngOnInit(){this.service.getMany().subscribe(e=>{this.rows=e,this.tmpRows=[...e],this.route.queryParamMap.subscribe(e=>{const t=e.get("fname");this._fName=t,this.filterDomain(t)})})}filterDomain(e){if(e){const t=e.toLowerCase(),c=this.tmpRows.filter(e=>e.id.toLowerCase().search(t)>-1);this.rows=c}}updateName(e){this.service.patch(e.id,{name:e.name}).subscribe()}selectRow(e){if(e.length){this.codedValues=[];const t=e[0];this.rowSelected=t,t.id&&this.loadCodedValues(t)}}loadCodedValues(e=this.rowSelected){this.service.getManyCodedValues(e.id).subscribe(e=>this.codedValues=e)}getCodeType(){if(!this.rowSelected||!this.rowSelected.type)return"string";{const e=this.rowSelected.type;if("esriFieldTypeInteger"===e||"esriFieldTypeSmallInteger"===e)return"number";if("esriFieldTypeString"===e)return"string"}}addCodedValue(){this.rowSelected&&this.rowSelected.id&&this.entityCodedValueAdd&&this.entityCodedValueAdd.code&&this.entityCodedValueAdd.name&&(this.isAddCodedValue=!0,this.service.insertCodedValue(this.rowSelected.id,this.entityCodedValueAdd).pipe(Object(i.a)(()=>this.isAddCodedValue=!1)).subscribe(()=>{this.toast.success("Th\xeam th\xe0nh c\xf4ng","Th\xf4ng b\xe1o"),this.loadCodedValues()},e=>this.toast.danger(e,"L\u1ed7i")))}deleteCodeValue(e){this.rowSelected&&this.rowSelected.id&&e.code&&this.service.deleteCodedValue(this.rowSelected.id,e.code).subscribe(()=>{this.toast.success("X\xf3a th\xe0nh c\xf4ng","Th\xf4ng b\xe1o"),this.loadCodedValues()})}getBuilderDomain(e){e.select(["name","type","codedValues"]),e.setJoin([{field:"codedValues",select:["code","domain","name"]}])}}return e.\u0275fac=function(t){return new(t||e)(o.Xb(d.a),o.Xb(a.qb),o.Xb(l.c),o.Xb(l.a),o.Xb(d.a))},e.\u0275cmp=o.Rb({type:e,selectors:[["ga-domain"]],decls:14,vars:9,consts:[[1,"row"],[1,"col-md-6"],["nbInput","","fieldSize","small","fullWidth","","placeholder","T\xecm ki\u1ebfm",3,"ngModel","ngModelChange"],["rowHeight","60","headerHeight","60","footerHeight","60","selectionType","single",1,"material","striped","mt-2",3,"limit","selected","datatableService","scrollbarV","select"],["width","250","name","T\xean","prop","id"],["width","250","name","M\xf4 t\u1ea3","prop","name"],["ngn-datatable-cell-template",""],[4,"ngIf"],["nbInput","","fieldSize","small","type","text","fullWidth","","placeholder","Nh\u1eadp m\xf4 t\u1ea3",3,"ngModel","ngModelChange","change"],[1,"d-flex"],["nbInput","","fieldSize","small","fullWidth","","placeholder","Nh\u1eadp gi\xe1 tr\u1ecb",1,"flex-grow-1",3,"type","ngModel","ngModelChange"],["nbInput","","fieldSize","small","fullWidth","","placeholder","M\xf4 t\u1ea3",1,"flex-grow-1","ml-2",3,"ngModel","ngModelChange"],["nbButton","","size","small","ghost","","nbTooltip","Th\xeam m\u1edbi",3,"nbSpinner","disabled","click"],["icon","plus-outline"],["rowHeight","60","headerHeight","60","columnMode","force","footerHeight","60",1,"material","striped","mt-2",3,"rows"],["name","Gi\xe1 tr\u1ecb","prop","code",3,"flexGrow"],["ngx-datatable-cell-template",""],["name","M\xf4 t\u1ea3","prop","name",3,"flexGrow"],["name","",3,"width"],["nbInput","","fieldSize","small","fullWidth","",3,"ngModel","type","ngModelChange"],["nbInput","","fieldSize","small","fullWidth","",3,"ngModel","ngModelChange"],["nbButton","","size","small","ghost","","nbTooltip","X\xf3a","status","danger",3,"click"],["icon","trash-outline"]],template:function(e,t){1&e&&(o.dc(0,"div",0),o.dc(1,"nb-card",1),o.dc(2,"nb-card-header"),o.Oc(3,"Danh m\u1ee5c domain"),o.cc(),o.dc(4,"nb-card-body"),o.dc(5,"input",2),o.kc("ngModelChange",(function(e){return t.fName=e})),o.cc(),o.dc(6,"ngn-datatable",3),o.kc("select",(function(e){return t.selectRow(e.selected)})),o.Yb(7,"ngn-datatable-column",4),o.dc(8,"ngn-datatable-column",5),o.Mc(9,u,1,1,"ng-template",6),o.cc(),o.cc(),o.cc(),o.cc(),o.dc(10,"nb-card",1),o.dc(11,"nb-card-header"),o.Oc(12,"Mi\u1ec1n gi\xe1 tr\u1ecb"),o.cc(),o.Mc(13,b,13,9,"nb-card-body",7),o.cc(),o.cc()),2&e&&(o.Lb(5),o.sc("ngModel",t.fName),o.Lb(1),o.sc("limit",10)("selected",t.rowSelected?o.vc(6,p,t.rowSelected):o.uc(8,f))("datatableService",t.datatableSeriveDomain)("scrollbarV",!1),o.Lb(7),o.sc("ngIf",t.rowSelected))},directives:[a.r,a.t,a.q,a.G,s.b,s.j,s.m,r.d,r.c,r.b,n.u,a.o,a.rb,a.kb,a.D],styles:[""]}),e})(),C=(()=>{class e{}return e.\u0275mod=o.Vb({type:e}),e.\u0275inj=o.Ub({factory:function(t){return new(t||e)},imports:[[n.c,s.g,a.H,a.u,a.p,a.F,a.sb,a.lb,r.e,l.g.forChild([{path:"",component:w}])],l.g]}),e})()}}]);